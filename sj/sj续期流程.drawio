<mxfile host="drawio-plugin" modified="2022-11-28T08:15:17.986Z" agent="5.0 (Windows NT 6.2; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/98.0.4758.102 Safari/537.36" etag="43u3fyOnYzJmoxo9UCBG" version="20.5.3" type="embed"><diagram name="Page-1" id="c7558073-3199-34d8-9f00-42111426c3f3"><mxGraphModel dx="1149" dy="718" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="826" pageHeight="1169" background="none" math="0" shadow="0"><root><mxCell id="0"/><mxCell id="1" parent="0"/><UserObject label="PolicyBatch" id="98"><mxCell style="swimlane;horizontal=0;whiteSpace=wrap;html=1;fontFamily=Lucida Console;verticalAlign=middle;" parent="1" vertex="1"><mxGeometry x="10" y="761" width="2000" height="3330" as="geometry"/></mxCell></UserObject><mxCell id="107" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;exitPerimeter=0;fontFamily=Lucida Console;" parent="98" source="103" target="104" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="103" value="&lt;span style=&quot;color: rgb(50, 50, 50); font-size: 18px; background-color: rgba(255, 255, 255, 0.01);&quot;&gt;renewPolicy&lt;br&gt;Schedule&lt;/span&gt;" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.start_2;whiteSpace=wrap;fillColor=#f8cecc;strokeColor=#b85450;fontFamily=Lucida Console;" parent="98" vertex="1"><mxGeometry x="70" y="40" width="110" height="110" as="geometry"/></mxCell><mxCell id="109" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontFamily=Lucida Console;" parent="98" source="104" target="108" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="133" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;entryPerimeter=0;dashed=1;" parent="98" source="104" target="131" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="104" value="&lt;div class=&quot;mind-clipboard&quot;&gt;setRenewDueDate(bizTime)&lt;div&gt;setPremStatus(NORMAL_PAYMENT(1, &quot;正常缴费&quot;))&lt;br&gt;&lt;/div&gt;&lt;div&gt;setRenewStatus(EFFECTIVE(1, &quot;生效中&quot;))&lt;br&gt;&lt;/div&gt;&lt;div&gt;以上作为条件查询&lt;/div&gt;&lt;div&gt;renew_policy_premium_schedule&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;fontFamily=Lucida Console;" parent="98" vertex="1"><mxGeometry x="255" y="34" width="230" height="120" as="geometry"/></mxCell><mxCell id="111" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontFamily=Lucida Console;" parent="98" source="108" target="110" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="108" value="&lt;div class=&quot;mind-clipboard&quot;&gt;&lt;div class=&quot;mind-clipboard&quot;&gt;每页最大的ID，以每页limit1000为基准，分页查询，按id正序排序，取每页最后一条记录更新maxIdValue，作为下一个分页查询的条件&lt;br&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;fontFamily=Lucida Console;" parent="98" vertex="1"><mxGeometry x="550" y="53.75" width="210" height="82.5" as="geometry"/></mxCell><mxCell id="110" value="&lt;div class=&quot;mind-clipboard&quot; style=&quot;font-size: 16px;&quot;&gt;查询获取到list&lt;div style=&quot;font-size: 16px;&quot;&gt;遍历，异步处理每个object&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;fontFamily=Lucida Console;fontSize=16;" parent="98" vertex="1"><mxGeometry x="820" y="50" width="150" height="90" as="geometry"/></mxCell><mxCell id="112" value="" style="verticalLabelPosition=bottom;verticalAlign=top;html=1;shape=mxgraph.flowchart.parallel_mode;pointerEvents=1;fontFamily=Lucida Console;" parent="98" vertex="1"><mxGeometry x="847.5" y="140" width="95" height="40" as="geometry"/></mxCell><mxCell id="123" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontFamily=Lucida Console;" parent="98" source="114" target="115" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="114" value="&lt;font color=&quot;#323232&quot;&gt;&lt;span style=&quot;font-size: 16px; background-color: rgba(255, 255, 255, 0.01);&quot;&gt;校验&lt;/span&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;fontFamily=Lucida Console;" parent="98" vertex="1"><mxGeometry x="1005" y="240" width="107.5" height="50" as="geometry"/></mxCell><mxCell id="122" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;entryPerimeter=0;fontFamily=Lucida Console;" parent="98" source="115" target="117" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="136" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;entryX=1.007;entryY=0.497;entryDx=0;entryDy=0;entryPerimeter=0;" parent="98" source="115" target="134" edge="1"><mxGeometry relative="1" as="geometry"><mxPoint x="1020" y="400" as="targetPoint"/></mxGeometry></mxCell><mxCell id="115" value="&lt;span style=&quot;color: rgb(50, 50, 50); font-size: 16px; background-color: rgba(255, 255, 255, 0.01);&quot;&gt;入参条件为保单号、交易状态为[1 初始化 INIT]，查询此保单是否存在还未缴费的账单（查询续期交易记录），对应表是renew_policy_transaction、renew_policy_transaction_detail&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;fontFamily=Lucida Console;" parent="98" vertex="1"><mxGeometry x="1125" y="340" width="315" height="120" as="geometry"/></mxCell><object label="" placeholders="1" id="125"><mxCell style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;entryPerimeter=0;fontFamily=Lucida Console;" parent="98" source="117" target="124" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell></object><mxCell id="129" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;exitPerimeter=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="98" source="117" target="127" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="117" value="&lt;span style=&quot;color: rgb(50, 50, 50); font-size: 16px; background-color: rgba(255, 255, 255, 0.01);&quot;&gt;未缴费的账单&lt;/span&gt;" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.decision;whiteSpace=wrap;fontFamily=Lucida Console;" parent="98" vertex="1"><mxGeometry x="1245.63" y="545" width="73.75" height="60" as="geometry"/></mxCell><mxCell id="124" value="&lt;font style=&quot;font-size: 16px;&quot;&gt;结束&lt;/font&gt;" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.terminator;whiteSpace=wrap;fontFamily=Lucida Console;" parent="98" vertex="1"><mxGeometry x="1040" y="545" width="100" height="60" as="geometry"/></mxCell><mxCell id="126" value="存在" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontFamily=Lucida Console;fontStyle=1" parent="98" vertex="1"><mxGeometry x="1167" y="545" width="60" height="30" as="geometry"/></mxCell><mxCell id="138" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1.007;entryY=0.507;entryDx=0;entryDy=0;entryPerimeter=0;dashed=1;" parent="98" source="127" target="137" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="140" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;entryPerimeter=0;" parent="98" source="127" target="139" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="127" value="&lt;div style=&quot;font-size: 16px;&quot; class=&quot;mind-clipboard&quot;&gt;判断续保新单首期是否缴费，入参条件为保单号、续保状态为[8 续保生效&lt;span style=&quot;font-size: inherit;&quot;&gt;&amp;nbsp;EFFECTIVE_RENEWAL]，对应表是&lt;/span&gt;renewal_policy，如果查询到数据，取字段[premStatus 支付状态]&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;fontFamily=Lucida Console;" parent="98" vertex="1"><mxGeometry x="1138.75" y="709" width="287.5" height="130" as="geometry"/></mxCell><mxCell id="130" value="不存在" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontFamily=Lucida Console;rotation=90;fontStyle=1" parent="98" vertex="1"><mxGeometry x="1269" y="630" width="60" height="30" as="geometry"/></mxCell><mxCell id="131" value="&lt;div&gt;SELECT&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;&quot;&gt;&#9;&lt;/span&gt;*&amp;nbsp;&lt;/div&gt;&lt;div&gt;FROM&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;&quot;&gt;&#9;&lt;/span&gt;sj_gr_policy_batch.renew_policy_premium_schedule&amp;nbsp;&lt;/div&gt;&lt;div&gt;WHERE&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;&quot;&gt;&#9;&lt;/span&gt;is_deleted = 'N'&amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;&quot;&gt;&#9;&lt;/span&gt;AND prem_status = 1&amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;&quot;&gt;&#9;&lt;/span&gt;AND renew_status = 1&amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;&quot;&gt;&#9;&lt;/span&gt;AND renew_due_date &amp;lt;= '2022-11-28 09:00:00'&amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;&quot;&gt;&#9;&lt;/span&gt;LIMIT 1000&lt;/div&gt;" style="shape=note;size=20;whiteSpace=wrap;html=1;align=left;verticalAlign=middle;" parent="98" vertex="1"><mxGeometry x="225" y="220" width="290" height="160" as="geometry"/></mxCell><mxCell id="134" value="&lt;div&gt;SELECT&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;&quot;&gt;&#9;&lt;/span&gt;*&amp;nbsp;&lt;/div&gt;&lt;div&gt;FROM&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;&quot;&gt;&#9;&lt;/span&gt;sj_gr_policy_batch.renew_policy_transaction&amp;nbsp;&lt;/div&gt;&lt;div&gt;WHERE&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;&quot;&gt;&#9;&lt;/span&gt;1 = 1&amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;&quot;&gt;&#9;&lt;/span&gt;AND policy_holder_customer_id = 9560591&amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;&quot;&gt;&#9;&lt;/span&gt;AND policy_no = 'SAG300247020'&amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;&quot;&gt;&#9;&lt;/span&gt;AND STATUS = 1&amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;&quot;&gt;&#9;&lt;/span&gt;AND is_deleted = 'N'&lt;/div&gt;" style="shape=note;size=20;whiteSpace=wrap;html=1;align=left;verticalAlign=middle;" parent="98" vertex="1"><mxGeometry x="760" y="320" width="250" height="160" as="geometry"/></mxCell><mxCell id="137" value="&lt;div&gt;SELECT&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;&quot;&gt;&#9;&lt;/span&gt;*&amp;nbsp;&lt;/div&gt;&lt;div&gt;FROM&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;&quot;&gt;&#9;&lt;/span&gt;sj_gr_policy_batch.renewal_policy&amp;nbsp;&lt;/div&gt;&lt;div&gt;WHERE&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;&quot;&gt;&#9;&lt;/span&gt;1 = 1&amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;&quot;&gt;&#9;&lt;/span&gt;AND renewal_status = 8&amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;&quot;&gt;&#9;&lt;/span&gt;AND next_policy_no = 'SAG300247020'&amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;&quot;&gt;&#9;&lt;/span&gt;AND is_deleted = 'N'&lt;/div&gt;" style="shape=note;size=20;whiteSpace=wrap;html=1;align=left;verticalAlign=middle;" parent="98" vertex="1"><mxGeometry x="780" y="703" width="220" height="140" as="geometry"/></mxCell><mxCell id="142" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;exitPerimeter=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;entryPerimeter=0;" parent="98" source="139" target="141" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="147" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=16;" parent="98" source="139" target="146" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="139" value="&lt;span style=&quot;color: rgb(50, 50, 50); font-size: 16px; background-color: rgba(255, 255, 255, 0.01);&quot;&gt;续保首期缴费状态&lt;/span&gt;" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.decision;whiteSpace=wrap;fontFamily=Lucida Console;" parent="98" vertex="1"><mxGeometry x="1245.6200000000001" y="930" width="73.75" height="60" as="geometry"/></mxCell><mxCell id="141" value="结束" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.terminator;whiteSpace=wrap;fontFamily=Lucida Console;fontSize=16;" parent="98" vertex="1"><mxGeometry x="1059" y="930" width="100" height="60" as="geometry"/></mxCell><mxCell id="143" value="NO" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontFamily=Lucida Console;fontStyle=1" parent="98" vertex="1"><mxGeometry x="1177" y="929" width="60" height="30" as="geometry"/></mxCell><mxCell id="145" value="&lt;span style=&quot;font-family: &amp;quot;Lucida Console&amp;quot;;&quot;&gt;是NO，代表续保首期保费未支付&lt;/span&gt;" style="shape=note;size=20;whiteSpace=wrap;html=1;fontSize=16;" parent="98" vertex="1"><mxGeometry x="1012.5" y="810" width="100" height="100" as="geometry"/></mxCell><mxCell id="150" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=16;" parent="98" source="146" target="149" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="203" style="edgeStyle=none;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;dashed=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;" edge="1" parent="98" source="146" target="201"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="146" value="&lt;div style=&quot;font-size: 16px;&quot; class=&quot;mind-clipboard&quot;&gt;&lt;div class=&quot;mind-clipboard&quot;&gt;根据保单号，未抽档flag等条件，查询续期相关信息(包括续期计划，缴费人信息，缴费频率，险种保费信息，险种计划,交易信息)[renew_policy_premium_schedule]表记录&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;fontFamily=Lucida Console;" parent="98" vertex="1"><mxGeometry x="1118.01" y="1050" width="328.99" height="130" as="geometry"/></mxCell><mxCell id="148" value="YES" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontFamily=Lucida Console;rotation=90;fontStyle=1" parent="98" vertex="1"><mxGeometry x="1268" y="1000" width="60" height="30" as="geometry"/></mxCell><mxCell id="205" style="edgeStyle=none;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;entryPerimeter=0;dashed=1;" edge="1" parent="98" source="149" target="204"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="207" style="edgeStyle=none;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="98" source="149" target="206"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="149" value="&lt;div style=&quot;&quot; class=&quot;mind-clipboard&quot;&gt;&lt;div style=&quot;&quot; class=&quot;mind-clipboard&quot;&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;font-size: 18px; color: rgb(50, 50, 50); font-family: Arial; background-color: rgba(255, 255, 255, 0.01);&quot;&gt;修改续期flag为抽档中，renew_policy_premium_schedule的flag改为&lt;/span&gt;&lt;span style=&quot;background-color: initial; font-size: 18px;&quot;&gt;&lt;font face=&quot;Arial&quot; color=&quot;#323232&quot;&gt;RUNNING(2,&quot;抽档中&quot;)&lt;/font&gt;&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;fontFamily=Lucida Console;" parent="98" vertex="1"><mxGeometry x="1146" y="1260" width="272.99" height="100" as="geometry"/></mxCell><mxCell id="151" value="&lt;div style=&quot;font-size: 12px;&quot;&gt;&lt;font style=&quot;font-size: 12px;&quot;&gt;SELECT&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 12px;&quot;&gt;&lt;font style=&quot;font-size: 12px;&quot;&gt;&lt;span style=&quot;font-size: 12px;&quot;&gt;&#9;&lt;/span&gt;*&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 12px;&quot;&gt;&lt;font style=&quot;font-size: 12px;&quot;&gt;FROM&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 12px;&quot;&gt;&lt;font style=&quot;font-size: 12px;&quot;&gt;&lt;span style=&quot;font-size: 12px;&quot;&gt;&#9;&lt;/span&gt;renew_policy_premium_schedule&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 12px;&quot;&gt;&lt;font style=&quot;font-size: 12px;&quot;&gt;WHERE&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 12px;&quot;&gt;&lt;font style=&quot;font-size: 12px;&quot;&gt;&lt;span style=&quot;font-size: 12px;&quot;&gt;&#9;&lt;/span&gt;1 = 1&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 12px;&quot;&gt;&lt;font style=&quot;font-size: 12px;&quot;&gt;&lt;span style=&quot;font-size: 12px;&quot;&gt;&#9;&lt;/span&gt;AND id = 9716297&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 12px;&quot;&gt;&lt;font style=&quot;font-size: 12px;&quot;&gt;&lt;span style=&quot;font-size: 12px;&quot;&gt;&#9;&lt;/span&gt;AND policy_no = 'SAG300247020'&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 12px;&quot;&gt;&lt;font style=&quot;font-size: 12px;&quot;&gt;&lt;span style=&quot;font-size: 12px;&quot;&gt;&#9;&lt;/span&gt;AND policy_holder_customer_id = 9560591&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 12px;&quot;&gt;&lt;font style=&quot;font-size: 12px;&quot;&gt;&lt;span style=&quot;font-size: 12px;&quot;&gt;&#9;&lt;/span&gt;AND prem_status = 1&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 12px;&quot;&gt;&lt;font style=&quot;font-size: 12px;&quot;&gt;&lt;span style=&quot;font-size: 12px;&quot;&gt;&#9;&lt;/span&gt;AND flag = 1&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 12px;&quot;&gt;&lt;font style=&quot;font-size: 12px;&quot;&gt;&#9;AND is_deleted = 'N';&lt;/font&gt;&lt;/div&gt;" style="shape=note;size=20;whiteSpace=wrap;html=1;fontSize=12;align=left;" parent="98" vertex="1"><mxGeometry x="154" y="927" width="200" height="200" as="geometry"/></mxCell><mxCell id="190" value="&lt;div style=&quot;font-size: 12px;&quot;&gt;&lt;div&gt;SELECT&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;&quot;&gt;&#9;&lt;/span&gt;*&amp;nbsp;&lt;/div&gt;&lt;div&gt;FROM&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;&quot;&gt;&#9;&lt;/span&gt;renew_premium_payer&amp;nbsp;&lt;/div&gt;&lt;div&gt;WHERE&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;&quot;&gt;&#9;&lt;/span&gt;1 = 1&amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;&quot;&gt;&#9;&lt;/span&gt;AND policy_holder_customer_id = 9560591&amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;&quot;&gt;&#9;&lt;/span&gt;AND renew_policy_premium_schedule_id = 9716297&amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;&quot;&gt;&#9;&lt;/span&gt;AND is_deleted = 'N'&lt;/div&gt;&lt;/div&gt;" style="shape=note;size=20;whiteSpace=wrap;html=1;fontSize=12;align=left;" parent="98" vertex="1"><mxGeometry x="394" y="932" width="200" height="190" as="geometry"/></mxCell><mxCell id="191" value="&lt;div style=&quot;font-size: 12px;&quot;&gt;&lt;div&gt;SELECT&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;&quot;&gt;&#9;&lt;/span&gt;*&amp;nbsp;&lt;/div&gt;&lt;div&gt;FROM&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;&quot;&gt;&#9;&lt;/span&gt;renew_product_premium_schedule&amp;nbsp;&lt;/div&gt;&lt;div&gt;WHERE&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;&quot;&gt;&#9;&lt;/span&gt;1 = 1&amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;&quot;&gt;&#9;&lt;/span&gt;AND renew_policy_premium_schedule_id = 9716297&amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;&quot;&gt;&#9;&lt;/span&gt;AND policy_holder_customer_id = 9560591&amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;&quot;&gt;&#9;&lt;/span&gt;AND is_deleted = 'N'&lt;/div&gt;&lt;/div&gt;" style="shape=note;size=20;whiteSpace=wrap;html=1;fontSize=12;align=left;" parent="98" vertex="1"><mxGeometry x="624" y="932" width="205" height="190" as="geometry"/></mxCell><mxCell id="192" value="&lt;div style=&quot;font-size: 12px;&quot;&gt;&lt;div&gt;SELECT&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;&quot;&gt;&#9;&lt;/span&gt;*&amp;nbsp;&lt;/div&gt;&lt;div&gt;FROM&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;&quot;&gt;&#9;&lt;/span&gt;renew_product_premium&amp;nbsp;&lt;/div&gt;&lt;div&gt;WHERE&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;&quot;&gt;&#9;&lt;/span&gt;1 = 1&amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;&quot;&gt;&#9;&lt;/span&gt;AND policy_holder_customer_id = 9560591&amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;&quot;&gt;&#9;&lt;/span&gt;AND renew_policy_premium_schedule_id = 9716297&amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;&quot;&gt;&#9;&lt;/span&gt;AND renew_product_premium_schedule_id = 9743789&amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;&quot;&gt;&#9;&lt;/span&gt;AND is_deleted = 'N'&lt;/div&gt;&lt;/div&gt;" style="shape=note;size=20;whiteSpace=wrap;html=1;fontSize=12;align=left;" parent="98" vertex="1"><mxGeometry x="154" y="1157" width="220" height="240" as="geometry"/></mxCell><mxCell id="193" value="&lt;div style=&quot;font-size: 12px;&quot;&gt;&lt;div&gt;SELECT&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;&quot;&gt;&#9;&lt;/span&gt;*&amp;nbsp;&lt;/div&gt;&lt;div&gt;FROM&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;&quot;&gt;&#9;&lt;/span&gt;renew_premium_frequency&amp;nbsp;&lt;/div&gt;&lt;div&gt;WHERE&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;&quot;&gt;&#9;&lt;/span&gt;1 = 1&amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;&quot;&gt;&#9;&lt;/span&gt;AND policy_holder_customer_id = 9560591&amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;&quot;&gt;&#9;&lt;/span&gt;AND renew_policy_premium_schedule_id = 9716297&amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;&quot;&gt;&#9;&lt;/span&gt;AND renew_product_premium_schedule_id = 9743792&amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;&quot;&gt;&#9;&lt;/span&gt;AND is_deleted = 'N'&lt;/div&gt;&lt;/div&gt;" style="shape=note;size=20;whiteSpace=wrap;html=1;fontSize=12;align=left;" parent="98" vertex="1"><mxGeometry x="389" y="1162" width="220" height="230" as="geometry"/></mxCell><mxCell id="194" value="&lt;div style=&quot;&quot;&gt;&lt;div style=&quot;&quot;&gt;SELECT&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;&quot;&gt;&#9;&lt;/span&gt;*&amp;nbsp;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;FROM&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;&quot;&gt;&#9;&lt;/span&gt;renew_policy_transaction&amp;nbsp;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;WHERE&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;&quot;&gt;&#9;&lt;/span&gt;1 = 1&amp;nbsp;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;&quot;&gt;&#9;&lt;/span&gt;AND policy_holder_customer_id = 9560591&amp;nbsp;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;&quot;&gt;&#9;&lt;/span&gt;AND renew_policy_premium_schedule_id = 9716297&amp;nbsp;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;&quot;&gt;&#9;&lt;/span&gt;AND is_deleted = 'N'&lt;/div&gt;&lt;/div&gt;" style="shape=note;size=20;whiteSpace=wrap;html=1;fontSize=12;align=left;" parent="98" vertex="1"><mxGeometry x="624" y="1167" width="220" height="190" as="geometry"/></mxCell><mxCell id="201" value="续期相关的查询sql" style="swimlane;whiteSpace=wrap;html=1;" vertex="1" parent="98"><mxGeometry x="127" y="865" width="745" height="560" as="geometry"/></mxCell><mxCell id="204" value="&lt;div&gt;UPDATE renew_policy_premium_schedule&amp;nbsp;&lt;/div&gt;&lt;div&gt;SET flag = 2,&lt;/div&gt;&lt;div&gt;gmt_modified = CURRENT_TIMESTAMP ( 3 )&amp;nbsp;&lt;/div&gt;&lt;div&gt;WHERE&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;&quot;&gt;&#9;&lt;/span&gt;id = 9762296&amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;&quot;&gt;&#9;&lt;/span&gt;AND policy_holder_customer_id = 9561535&lt;/div&gt;" style="shape=note;size=20;whiteSpace=wrap;html=1;align=left;verticalAlign=middle;" vertex="1" parent="98"><mxGeometry x="1530" y="1230" width="220" height="140" as="geometry"/></mxCell><mxCell id="209" style="edgeStyle=none;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="98" source="206" target="208"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="206" value="&lt;div style=&quot;font-size: 16px;&quot; class=&quot;mind-clipboard&quot;&gt;&lt;div class=&quot;mind-clipboard&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(50, 50, 50); font-family: Arial; font-size: 20px; background-color: rgba(255, 255, 255, 0.01);&quot;&gt;查询保单信息&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;fontFamily=Lucida Console;" vertex="1" parent="98"><mxGeometry x="1195.51" y="1460" width="173.99" height="60" as="geometry"/></mxCell><mxCell id="218" style="edgeStyle=none;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=16;" edge="1" parent="98" source="208" target="217"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="208" value="&lt;span style=&quot;color: rgb(50, 50, 50); font-size: 16px; background-color: rgba(255, 255, 255, 0.01);&quot;&gt;dueDate comapre&lt;br&gt;expiryDate&lt;br&gt;&lt;/span&gt;" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.decision;whiteSpace=wrap;fontFamily=Lucida Console;" vertex="1" parent="98"><mxGeometry x="1245.63" y="1590" width="73.75" height="60" as="geometry"/></mxCell><mxCell id="212" value="缴费时间不与保单止期在同一个月，进行抽档" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=16;" vertex="1" parent="98"><mxGeometry x="1310.37" y="1550" width="192.63" height="65" as="geometry"/></mxCell><mxCell id="224" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;dashed=1;fontSize=16;" edge="1" parent="98" source="217" target="223"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="217" value="&lt;div style=&quot;font-size: 16px;&quot; class=&quot;mind-clipboard&quot;&gt;&lt;div class=&quot;mind-clipboard&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(50, 50, 50); font-family: Arial; background-color: rgba(255, 255, 255, 0.01);&quot;&gt;生成续期交易流水号&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;fontFamily=Lucida Console;" vertex="1" parent="98"><mxGeometry x="1195.51" y="1737" width="173.99" height="60" as="geometry"/></mxCell><mxCell id="219" value="不在同月" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontFamily=Lucida Console;rotation=90;fontStyle=1" vertex="1" parent="98"><mxGeometry x="1269" y="1671" width="60" height="30" as="geometry"/></mxCell><mxCell id="226" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;fontSize=16;" edge="1" parent="98" source="223" target="225"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="228" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;dashed=1;fontSize=16;" edge="1" parent="98" source="223" target="227"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="223" value="&lt;div style=&quot;font-size: 16px;&quot; class=&quot;mind-clipboard&quot;&gt;&lt;div class=&quot;mind-clipboard&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(50, 50, 50); font-family: Arial; background-color: rgba(255, 255, 255, 0.01);&quot;&gt;组装续期交易请求参数&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(50, 50, 50); font-family: Arial; background-color: rgba(255, 255, 255, 0.01);&quot;&gt;保存交易信息以及交易明细，renew_policy_transaction、renew_policy_transaction_detail&lt;/span&gt;&lt;span style=&quot;color: rgb(50, 50, 50); font-family: Arial; background-color: rgba(255, 255, 255, 0.01);&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;fontFamily=Lucida Console;" vertex="1" parent="98"><mxGeometry x="1160.25" y="1870" width="244.49" height="110" as="geometry"/></mxCell><mxCell id="225" value="&lt;div style=&quot;&quot;&gt;&lt;div style=&quot;&quot;&gt;insert into renew_policy_transaction&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;insert into renew_router&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;insert into renew_policy_transaction_detail&lt;br&gt;&lt;/div&gt;&lt;/div&gt;" style="shape=note;size=20;whiteSpace=wrap;html=1;fontSize=12;align=left;" vertex="1" parent="98"><mxGeometry x="847.5" y="1890" width="231" height="70" as="geometry"/></mxCell><mxCell id="230" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;dashed=1;fontSize=16;" edge="1" parent="98" source="227" target="229"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="227" value="&lt;div style=&quot;font-size: 16px;&quot; class=&quot;mind-clipboard&quot;&gt;&lt;div class=&quot;mind-clipboard&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(50, 50, 50); font-family: Arial; background-color: rgba(255, 255, 255, 0.01);&quot;&gt;累加保费险种保费明细的期缴保费，得到总的应收保费&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;fontFamily=Lucida Console;" vertex="1" parent="98"><mxGeometry x="1162.26" y="2040" width="239.74" height="70" as="geometry"/></mxCell><mxCell id="229" value="&lt;div style=&quot;font-size: 16px;&quot; class=&quot;mind-clipboard&quot;&gt;&lt;div class=&quot;mind-clipboard&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(50, 50, 50); font-family: Arial; font-size: 17px; background-color: rgba(255, 255, 255, 0.01);&quot;&gt;调用bcp创建续期应收账单&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;fontFamily=Lucida Console;" vertex="1" parent="98"><mxGeometry x="1173" y="2180" width="218" height="50" as="geometry"/></mxCell><mxCell id="231" value="&lt;div style=&quot;font-size: 16px;&quot; class=&quot;mind-clipboard&quot;&gt;&lt;div class=&quot;mind-clipboard&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(50, 50, 50); font-family: Arial; font-size: 17px; background-color: rgba(255, 255, 255, 0.01);&quot;&gt;调用bcp创建续期应收账单，成功返回后，更新renew_due_date和index，分别往后延1，得到下期缴费日期以及index&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;fontFamily=Lucida Console;" vertex="1" parent="98"><mxGeometry x="1160.26" y="2370" width="244.49" height="110" as="geometry"/></mxCell><mxCell id="232" value="&lt;div style=&quot;font-size: 16px;&quot; class=&quot;mind-clipboard&quot;&gt;&lt;div class=&quot;mind-clipboard&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(50, 50, 50); font-family: Arial; font-size: 17px; background-color: rgba(255, 255, 255, 0.01);&quot;&gt;调用bcp创建续期应收账单，成功返回后，更新renew_due_date和index，分别往后延1，得到下期缴费日期以及index&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;fontFamily=Lucida Console;" vertex="1" parent="98"><mxGeometry x="1160.26" y="2556" width="244.49" height="110" as="geometry"/></mxCell><mxCell id="220" value="foundation" style="swimlane;horizontal=0;whiteSpace=wrap;html=1;fontSize=16;" vertex="1" parent="1"><mxGeometry x="20" y="440" width="2000" height="260" as="geometry"/></mxCell><mxCell id="221" value="&lt;div style=&quot;&quot; class=&quot;mind-clipboard&quot;&gt;&lt;div style=&quot;&quot; class=&quot;mind-clipboard&quot;&gt;&lt;div style=&quot;&quot;&gt;&lt;font face=&quot;Arial&quot; color=&quot;#323232&quot;&gt;/bizno/policy&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;fontFamily=Lucida Console;fontSize=16;" vertex="1" parent="220"><mxGeometry x="1810" y="95" width="130" height="50" as="geometry"/></mxCell><mxCell id="222" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=16;dashed=1;" edge="1" parent="1" source="217" target="221"><mxGeometry relative="1" as="geometry"/></mxCell></root></mxGraphModel></diagram></mxfile>