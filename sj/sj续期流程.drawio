<mxfile host="drawio-plugin" modified="2022-11-22T06:49:51.779Z" agent="5.0 (Windows NT 6.2; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/98.0.4758.102 Safari/537.36" etag="h1Tjx0gTNFGQAL1tt471" version="20.5.3" type="embed"><diagram name="Page-1" id="c7558073-3199-34d8-9f00-42111426c3f3"><mxGraphModel dx="1379" dy="862" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="826" pageHeight="1169" background="none" math="0" shadow="0"><root><mxCell id="0"/><mxCell id="1" parent="0"/><UserObject label="PolicyBatch" id="98"><mxCell style="swimlane;horizontal=0;whiteSpace=wrap;html=1;fontFamily=Lucida Console;" vertex="1" parent="1"><mxGeometry x="80" y="780" width="2010" height="1230" as="geometry"/></mxCell></UserObject><mxCell id="107" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;exitPerimeter=0;fontFamily=Lucida Console;" edge="1" parent="98" source="103" target="104"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="103" value="&lt;span style=&quot;color: rgb(50, 50, 50); font-size: 18px; background-color: rgba(255, 255, 255, 0.01);&quot;&gt;renewPolicy&lt;br&gt;Schedule&lt;/span&gt;" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.start_2;whiteSpace=wrap;fillColor=#f8cecc;strokeColor=#b85450;fontFamily=Lucida Console;" vertex="1" parent="98"><mxGeometry x="70" y="40" width="110" height="110" as="geometry"/></mxCell><mxCell id="109" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontFamily=Lucida Console;" edge="1" parent="98" source="104" target="108"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="104" value="&lt;div class=&quot;mind-clipboard&quot;&gt;setRenewDueDate(上个月月末的23:59:59)&lt;div&gt;setPremStatus(NORMAL_PAYMENT)&lt;br&gt;&lt;/div&gt;&lt;div&gt;setRenewStatus(EFFECTIVE)&lt;br&gt;&lt;/div&gt;&lt;div&gt;以上作为条件查询&lt;/div&gt;&lt;div&gt;renew_policy_premium_schedule&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;fontFamily=Lucida Console;" vertex="1" parent="98"><mxGeometry x="260" y="40" width="220" height="110" as="geometry"/></mxCell><mxCell id="111" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontFamily=Lucida Console;" edge="1" parent="98" source="108" target="110"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="108" value="&lt;div class=&quot;mind-clipboard&quot;&gt;&lt;div class=&quot;mind-clipboard&quot;&gt;每页最大的ID，以每页limit1000为基准，分页查询，按id正序排序，取每页最后一条记录更新maxIdValue，作为下一个分页查询的条件&lt;br&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;fontFamily=Lucida Console;" vertex="1" parent="98"><mxGeometry x="550" y="57.5" width="200" height="75" as="geometry"/></mxCell><mxCell id="110" value="&lt;div class=&quot;mind-clipboard&quot;&gt;查询获取到list&lt;div&gt;遍历，异步处理每个object&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;fontFamily=Lucida Console;" vertex="1" parent="98"><mxGeometry x="820" y="50" width="150" height="90" as="geometry"/></mxCell><mxCell id="112" value="" style="verticalLabelPosition=bottom;verticalAlign=top;html=1;shape=mxgraph.flowchart.parallel_mode;pointerEvents=1;fontFamily=Lucida Console;" vertex="1" parent="98"><mxGeometry x="847.5" y="140" width="95" height="40" as="geometry"/></mxCell><mxCell id="123" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontFamily=Lucida Console;" edge="1" parent="98" source="114" target="115"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="114" value="&lt;font color=&quot;#323232&quot;&gt;&lt;span style=&quot;font-size: 16px; background-color: rgba(255, 255, 255, 0.01);&quot;&gt;校验&lt;/span&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;fontFamily=Lucida Console;" vertex="1" parent="98"><mxGeometry x="1005" y="240" width="107.5" height="50" as="geometry"/></mxCell><mxCell id="122" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;entryPerimeter=0;fontFamily=Lucida Console;" edge="1" parent="98" source="115" target="117"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="115" value="&lt;span style=&quot;color: rgb(50, 50, 50); font-size: 16px; background-color: rgba(255, 255, 255, 0.01);&quot;&gt;入参条件为保单号、交易状态为[1 初始化 INIT]，查询此保单是否存在还未缴费的账单（查询续期交易记录），对应表是renew_policy_transaction、renew_policy_transaction_detail&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;fontFamily=Lucida Console;" vertex="1" parent="98"><mxGeometry x="1125" y="340" width="315" height="120" as="geometry"/></mxCell><object label="" placeholders="1" id="125"><mxCell style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;entryPerimeter=0;fontFamily=Lucida Console;" edge="1" parent="98" source="117" target="124"><mxGeometry relative="1" as="geometry"/></mxCell></object><mxCell id="117" value="&lt;span style=&quot;color: rgb(50, 50, 50); font-size: 16px; background-color: rgba(255, 255, 255, 0.01);&quot;&gt;未缴费的账单&lt;/span&gt;" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.decision;whiteSpace=wrap;fontFamily=Lucida Console;" vertex="1" parent="98"><mxGeometry x="1245.63" y="545" width="73.75" height="60" as="geometry"/></mxCell><mxCell id="124" value="结束" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.terminator;whiteSpace=wrap;fontFamily=Lucida Console;" vertex="1" parent="98"><mxGeometry x="980" y="545" width="100" height="60" as="geometry"/></mxCell><mxCell id="126" value="存在" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontFamily=Lucida Console;" vertex="1" parent="98"><mxGeometry x="1140" y="550" width="60" height="30" as="geometry"/></mxCell><mxCell id="127" value="&lt;div style=&quot;font-size: 16px;&quot; class=&quot;mind-clipboard&quot;&gt;判断续保新单首期是否缴费，入参条件为保单号、续保状态为[8 续保生效&lt;span style=&quot;font-size: inherit;&quot;&gt;&amp;nbsp;EFFECTIVE_RENEWAL]，对应表是&lt;/span&gt;renewal_policy，如果查询到数据，取字段[premStatus 支付状态]，如果是NO，代表续保首期保费未支付，返回false，处理停止&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;fontFamily=Lucida Console;" vertex="1" parent="98"><mxGeometry x="1510" y="340" width="280" height="110" as="geometry"/></mxCell></root></mxGraphModel></diagram></mxfile>