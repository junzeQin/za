<mxfile host="drawio-plugin" modified="2022-12-28T07:46:47.663Z" agent="5.0 (Windows NT 6.2; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/104.0.5112.102 Safari/537.36" etag="C_Y86YGy4dT2OBIIFuqM" version="20.5.3" type="embed"><diagram name="Page-1" id="c7558073-3199-34d8-9f00-42111426c3f3"><mxGraphModel dx="716" dy="628" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="826" pageHeight="1169" background="none" math="0" shadow="0"><root><mxCell id="0"/><mxCell id="1" parent="0"/><UserObject label="bcp" id="98"><mxCell style="swimlane;horizontal=0;html=1;fontFamily=Lucida Console;verticalAlign=middle;fontSize=16;align=center;whiteSpace=wrap;" parent="1" vertex="1"><mxGeometry x="20" y="213" width="3290" height="2127" as="geometry"/></mxCell></UserObject><mxCell id="226" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="98" source="222" target="225" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="222" value="&lt;div class=&quot;mind-clipboard&quot; style=&quot;font-size: 16px;&quot;&gt;setTransType(RENEWAL(4, &quot;续期&quot;))&lt;div style=&quot;font-size: 16px;&quot;&gt;setBillStatus(PENDING(1, &quot;待处理&quot;),&lt;span style=&quot;background-color: initial;&quot;&gt;TRANSFER_FAILURE(7, &quot;转账失败&quot;)&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;)&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 16px;&quot;&gt;setArapAccountType(YAHOO_WALLET_SJ(135,&quot;ウォレット / Yahoo&quot;))&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/div&gt;&lt;div style=&quot;text-align: center; font-size: 16px;&quot;&gt;以上作为条件查询&lt;/div&gt;&lt;div style=&quot;text-align: center; font-size: 16px;&quot;&gt;bill&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;fontFamily=Lucida Console;align=left;fontSize=16;" parent="98" vertex="1"><mxGeometry x="390" y="68.78999999999999" width="410" height="143.67" as="geometry"/></mxCell><mxCell id="224" value="&lt;span style=&quot;color: rgb(16, 18, 20); font-family: &amp;quot;PingFang SC&amp;quot;, &amp;quot;Segoe UI&amp;quot;, Arial, &amp;quot;Microsoft YaHei&amp;quot;, 微软雅黑, 宋体, &amp;quot;Malgun Gothic&amp;quot;, sans-serif; font-size: 14px; text-align: start; background-color: rgb(255, 255, 255);&quot;&gt;编排调度&lt;/span&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="98" vertex="1"><mxGeometry x="151" y="56" width="120" height="30" as="geometry"/></mxCell><mxCell id="280" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="98" source="225" target="227" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="225" value="&lt;div class=&quot;mind-clipboard&quot; style=&quot;font-size: 16px;&quot;&gt;&lt;div class=&quot;mind-clipboard&quot; style=&quot;font-size: 16px;&quot;&gt;每页最大的ID，以每页limit1000为基准，分页查询，按id正序排序，取每页最后一条记录更新maxIdValue，作为下一个分页查询的条件&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;fontFamily=Lucida Console;fontSize=16;" parent="98" vertex="1"><mxGeometry x="921" y="86" width="230" height="109.25" as="geometry"/></mxCell><mxCell id="227" value="&lt;div class=&quot;mind-clipboard&quot; style=&quot;font-size: 16px;&quot;&gt;查询获取到list&lt;div style=&quot;font-size: 16px;&quot;&gt;遍历，异步处理每个object&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;fontFamily=Lucida Console;fontSize=16;" parent="98" vertex="1"><mxGeometry x="1255" y="96.25" width="150" height="90" as="geometry"/></mxCell><mxCell id="221" value="&lt;font color=&quot;#323232&quot;&gt;&lt;span style=&quot;background-color: rgba(255, 255, 255, 0.01);&quot;&gt;&lt;span style=&quot;font-size: 18px;&quot;&gt;雅虎续期缴费&lt;/span&gt;&lt;br&gt;&lt;span style=&quot;font-size: 18px;&quot;&gt;renewAutoDeductionForYahooWallet&lt;/span&gt;&lt;br&gt;&lt;span style=&quot;font-size: 18px;&quot;&gt;Schedule&lt;/span&gt;&lt;br&gt;&lt;/span&gt;&lt;/font&gt;" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.start_2;whiteSpace=wrap;fillColor=#f8cecc;strokeColor=#b85450;fontFamily=Lucida Console;" parent="98" vertex="1"><mxGeometry x="167.5" y="100.75" width="87" height="81" as="geometry"/></mxCell><mxCell id="223" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="98" source="221" target="222" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="276" style="edgeStyle=none;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0;entryDx=200;entryDy=95;entryPerimeter=0;dashed=1;fontFamily=Lucida Console;fontSize=16;" parent="98" source="273" target="275" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="279" style="edgeStyle=none;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Lucida Console;fontSize=16;" parent="98" source="273" target="277" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="273" value="&lt;font face=&quot;微软雅黑&quot; color=&quot;#323232&quot;&gt;&lt;span style=&quot;background-color: rgba(255, 255, 255, 0.01);&quot;&gt;根据bill上的支付方式&lt;br&gt;查询支付方式配置&lt;/span&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Lucida Console;fontSize=16;" parent="98" vertex="1"><mxGeometry x="1779.1400000000003" y="313" width="156.86" height="64" as="geometry"/></mxCell><mxCell id="275" value="&lt;div class=&quot;mind-clipboard&quot;&gt;SELECT&lt;div&gt;&lt;/div&gt;*&lt;div&gt;&lt;/div&gt;FROM&lt;div&gt;&lt;/div&gt;payment_config &lt;div&gt;&lt;/div&gt;WHERE&lt;div&gt;&lt;/div&gt;1 = 1 &lt;div&gt;&lt;/div&gt;AND pay_method = 135&lt;div&gt;&lt;/div&gt;AND is_deleted = 'N'&lt;/div&gt;" style="shape=note;size=20;whiteSpace=wrap;html=1;fontFamily=Lucida Console;fontSize=16;align=left;" parent="98" vertex="1"><mxGeometry x="1426" y="237" width="200" height="170" as="geometry"/></mxCell><mxCell id="283" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="98" source="277" target="281" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="284" value="&lt;font face=&quot;Lucida Console&quot;&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;NO_NEED_NOW_PAY&lt;/span&gt;&lt;/font&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="283" vertex="1" connectable="0"><mxGeometry x="-0.266" relative="1" as="geometry"><mxPoint x="-36" y="37" as="offset"/></mxGeometry></mxCell><mxCell id="285" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontFamily=Lucida Console;fontSize=16;" parent="98" source="277" target="282" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="286" value="NEED_NOW_PAY" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=16;fontFamily=Lucida Console;" parent="285" vertex="1" connectable="0"><mxGeometry x="-0.3268" y="1" relative="1" as="geometry"><mxPoint x="35" y="38" as="offset"/></mxGeometry></mxCell><mxCell id="492" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;exitPerimeter=0;" parent="98" source="277" target="281" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="493" value="&lt;font face=&quot;Lucida Console&quot; style=&quot;font-size: 16px;&quot;&gt;null&lt;/font&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="492" vertex="1" connectable="0"><mxGeometry x="-0.613" y="-1" relative="1" as="geometry"><mxPoint as="offset"/></mxGeometry></mxCell><mxCell id="277" value="&lt;span style=&quot;color: rgb(50, 50, 50); font-size: 16px; background-color: rgba(255, 255, 255, 0.01);&quot;&gt;支付类型&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.decision;whiteSpace=wrap;fontFamily=Lucida Console;fontSize=16;" parent="98" vertex="1"><mxGeometry x="1814.1400000000003" y="426" width="73.75" height="60" as="geometry"/></mxCell><mxCell id="550" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Lucida Console;fontSize=16;" parent="98" source="281" target="523" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="281" value="&lt;span style=&quot;color: rgb(50, 50, 50); font-family: 微软雅黑; background-color: rgba(255, 255, 255, 0.01);&quot;&gt;confirmRenewBill&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Lucida Console;fontSize=16;" parent="98" vertex="1"><mxGeometry x="1635.4" y="543" width="143.74" height="42" as="geometry"/></mxCell><mxCell id="287" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;fontFamily=Lucida Console;fontSize=16;" parent="98" source="282" target="281" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="282" value="&lt;font face=&quot;微软雅黑&quot; color=&quot;#323232&quot;&gt;&lt;span style=&quot;background-color: rgba(255, 255, 255, 0.01);&quot;&gt;调用YAHOO-WALLET扣款&lt;/span&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Lucida Console;fontSize=16;" parent="98" vertex="1"><mxGeometry x="1920" y="540.5" width="166.5" height="47" as="geometry"/></mxCell><mxCell id="420" value="/bcp/queryBcpPage" style="rounded=1;whiteSpace=wrap;html=1;fontSize=16;fontFamily=Lucida Console;" parent="98" vertex="1"><mxGeometry x="2594" y="1928" width="180" height="72" as="geometry"/></mxCell><mxCell id="555" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;fontFamily=Lucida Console;fontSize=16;dashed=1;" parent="98" source="523" target="551" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="523" value="查询bill及相关detail" style="rounded=1;whiteSpace=wrap;html=1;fontSize=16;fontFamily=Lucida Console;" parent="98" vertex="1"><mxGeometry x="1647" y="644" width="120" height="60" as="geometry"/></mxCell><mxCell id="526" value="billStatus" style="rhombus;whiteSpace=wrap;html=1;fontFamily=Lucida Console;fontSize=16;" parent="98" vertex="1"><mxGeometry x="1667" y="774" width="80" height="80" as="geometry"/></mxCell><mxCell id="527" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Lucida Console;fontSize=16;" parent="98" source="523" target="526" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="528" value="&lt;font color=&quot;#323232&quot;&gt;&lt;span style=&quot;background-color: rgba(255, 255, 255, 0.01);&quot;&gt;&lt;span style=&quot;font-size: 18px;&quot;&gt;stop&lt;/span&gt;&lt;br&gt;&lt;/span&gt;&lt;/font&gt;" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.start_2;whiteSpace=wrap;fillColor=#f8cecc;strokeColor=#b85450;fontFamily=Lucida Console;" parent="98" vertex="1"><mxGeometry x="1486" y="904" width="87" height="81" as="geometry"/></mxCell><mxCell id="529" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;entryPerimeter=0;fontFamily=Lucida Console;fontSize=16;" parent="98" source="526" target="528" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="530" value="ELSE" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=16;fontFamily=Lucida Console;" parent="529" vertex="1" connectable="0"><mxGeometry x="-0.2053" y="-3" relative="1" as="geometry"><mxPoint x="1" y="3" as="offset"/></mxGeometry></mxCell><mxCell id="531" value="查询续期余额&lt;br&gt;[collection_balance]" style="rounded=1;whiteSpace=wrap;html=1;fontSize=16;fontFamily=Lucida Console;" parent="98" vertex="1"><mxGeometry x="1826" y="914.5" width="120" height="60" as="geometry"/></mxCell><mxCell id="532" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontFamily=Lucida Console;fontSize=16;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="98" source="526" target="531" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="533" value="TRANSFER_FAILURE" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=16;fontFamily=Lucida Console;" parent="532" vertex="1" connectable="0"><mxGeometry x="-0.715" y="-1" relative="1" as="geometry"><mxPoint as="offset"/></mxGeometry></mxCell><mxCell id="534" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontFamily=Lucida Console;fontSize=16;" parent="98" source="526" target="531" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="535" value="PENDING" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=16;fontFamily=Lucida Console;" parent="534" vertex="1" connectable="0"><mxGeometry x="-0.0437" y="-2" relative="1" as="geometry"><mxPoint x="-38" y="-3" as="offset"/></mxGeometry></mxCell><mxCell id="536" value="插入余额抵扣的实收数据[collection_transaction]" style="rounded=1;whiteSpace=wrap;html=1;fontSize=16;fontFamily=Lucida Console;" parent="98" vertex="1"><mxGeometry x="1821" y="1042" width="130" height="62" as="geometry"/></mxCell><mxCell id="537" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Lucida Console;fontSize=16;" parent="98" source="531" target="536" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="538" value="冲销续期余额，会变成0，更新&lt;br&gt;[collection_balance]" style="rounded=1;whiteSpace=wrap;html=1;fontSize=16;fontFamily=Lucida Console;" parent="98" vertex="1"><mxGeometry x="1813.5" y="1164" width="145" height="72" as="geometry"/></mxCell><mxCell id="539" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Lucida Console;fontSize=16;" parent="98" source="536" target="538" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="540" value="插入冲销记录数据[cp_note_offset]" style="rounded=1;whiteSpace=wrap;html=1;fontSize=16;fontFamily=Lucida Console;" parent="98" vertex="1"><mxGeometry x="1821" y="1302" width="130" height="62" as="geometry"/></mxCell><mxCell id="541" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Lucida Console;fontSize=16;" parent="98" source="538" target="540" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="556" style="edgeStyle=none;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Lucida Console;fontSize=16;" parent="98" source="542" target="548" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="542" value="&lt;div&gt;setBillStatus(BillStatusEnum.CONFIRMED);&lt;/div&gt;&lt;div&gt;setBillConfirmDate($bizDate);&lt;/div&gt;更新bill" style="rounded=1;whiteSpace=wrap;html=1;fontSize=16;fontFamily=Lucida Console;" parent="98" vertex="1"><mxGeometry x="1793.5" y="1428" width="185" height="72" as="geometry"/></mxCell><mxCell id="543" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Lucida Console;fontSize=16;" parent="98" source="540" target="542" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="546" value="&lt;font color=&quot;#323232&quot;&gt;&lt;span style=&quot;background-color: rgba(255, 255, 255, 0.01);&quot;&gt;&lt;span style=&quot;font-size: 18px;&quot;&gt;stop&lt;/span&gt;&lt;br&gt;&lt;/span&gt;&lt;/font&gt;" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.start_2;whiteSpace=wrap;fillColor=#f8cecc;strokeColor=#b85450;fontFamily=Lucida Console;" parent="98" vertex="1"><mxGeometry x="1842.5" y="1761" width="87" height="81" as="geometry"/></mxCell><mxCell id="547" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="98" source="548" target="546" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="548" value="发送bcp消息，topic:tech-sj-环境-bcp-topic，tag:za-graphene-bcp-notice-send-bill，发送内容为bill对象&lt;br&gt;主要是作用是policyBatch消费更新冲销续期相关数据" style="rounded=1;whiteSpace=wrap;html=1;fontSize=16;fontFamily=Lucida Console;" parent="98" vertex="1"><mxGeometry x="1743.13" y="1569" width="285.75" height="119" as="geometry"/></mxCell><mxCell id="551" value="&lt;span style=&quot;color: rgb(50, 50, 50); font-family: 微软雅黑; font-weight: 400; background-color: rgba(255, 255, 255, 0.01);&quot;&gt;查询保单bcp相关记录详情&lt;/span&gt;" style="swimlane;whiteSpace=wrap;html=1;fontFamily=Lucida Console;fontSize=16;" parent="98" vertex="1"><mxGeometry x="616" y="486" width="900" height="292" as="geometry"/></mxCell><mxCell id="552" value="&lt;div class=&quot;mind-clipboard&quot;&gt;SELECT&lt;div&gt;&lt;/div&gt;*&lt;div&gt;&lt;/div&gt;FROM&lt;div&gt;&lt;/div&gt;bill &lt;div&gt;&lt;/div&gt;WHERE&lt;div&gt;&lt;/div&gt;1 = 1 &lt;div&gt;&lt;/div&gt;AND policy_no = 'SAH300240007' &lt;div&gt;&lt;/div&gt;AND trans_type = 4 &lt;div&gt;&lt;/div&gt;AND bill_status IN ( 1, 7 ) &lt;div&gt;&lt;/div&gt;AND payee_id IN ( 9559386 ) &lt;div&gt;&lt;/div&gt;AND is_deleted = 'N'&lt;/div&gt;" style="shape=note;size=20;whiteSpace=wrap;html=1;fontFamily=Lucida Console;fontSize=16;align=left;" parent="551" vertex="1"><mxGeometry x="10" y="39.5" width="280" height="240.5" as="geometry"/></mxCell><mxCell id="553" value="&lt;div class=&quot;mind-clipboard&quot;&gt;&lt;div class=&quot;mind-clipboard&quot;&gt;SELECT&lt;div&gt;&lt;/div&gt;*&lt;div&gt;&lt;/div&gt;FROM&lt;div&gt;&lt;/div&gt;receivable_payable &lt;div&gt;&lt;/div&gt;WHERE&lt;div&gt;&lt;/div&gt;1 = 1 &lt;div&gt;&lt;/div&gt;AND bill_id = 9703721 &lt;div&gt;&lt;/div&gt;AND policy_no = 'SAH300240007' &lt;div&gt;&lt;/div&gt;AND payee_id = 9559386&amp;nbsp;&amp;nbsp;&lt;div&gt;&lt;/div&gt;AND is_deleted = 'N'&lt;/div&gt;&lt;/div&gt;" style="shape=note;size=20;whiteSpace=wrap;html=1;fontFamily=Lucida Console;fontSize=16;align=left;" parent="551" vertex="1"><mxGeometry x="310" y="39.5" width="280" height="240.5" as="geometry"/></mxCell><mxCell id="554" value="&lt;div class=&quot;mind-clipboard&quot;&gt;&lt;div class=&quot;mind-clipboard&quot;&gt;SELECT&lt;div&gt;&lt;/div&gt;* &lt;div&gt;&lt;/div&gt;FROM&lt;div&gt;&lt;/div&gt;bcp_ext_info &lt;div&gt;&lt;/div&gt;WHERE&lt;div&gt;&lt;/div&gt;1 = 1 &lt;div&gt;&lt;/div&gt;AND bill_id = 9703721 &lt;div&gt;&lt;/div&gt;AND is_deleted = 'N'&lt;/div&gt;&lt;/div&gt;" style="shape=note;size=20;whiteSpace=wrap;html=1;fontFamily=Lucida Console;fontSize=16;align=left;" parent="551" vertex="1"><mxGeometry x="606" y="69.5" width="282" height="180.5" as="geometry"/></mxCell><mxCell id="411" value="policyBatch" style="swimlane;horizontal=0;whiteSpace=wrap;html=1;fontSize=16;fontFamily=Lucida Console;" parent="1" vertex="1"><mxGeometry x="20" y="2381" width="3300" height="1979" as="geometry"/></mxCell><mxCell id="557" value="&lt;div style=&quot;&quot; class=&quot;mind-clipboard&quot;&gt;&lt;div style=&quot;&quot; class=&quot;mind-clipboard&quot;&gt;&lt;div style=&quot;&quot;&gt;&lt;font color=&quot;#323232&quot;&gt;consumerChange&lt;br&gt;BcpConsumer&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;fontFamily=Lucida Console;fontSize=16;" parent="411" vertex="1"><mxGeometry x="2055.25" y="59" width="140" height="51" as="geometry"/></mxCell><mxCell id="558" value="&lt;div&gt;SELECT&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;&quot;&gt;&#9;&lt;/span&gt;*&amp;nbsp;&lt;/div&gt;&lt;div&gt;FROM&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;&quot;&gt;&#9;&lt;/span&gt;`sj_gr_policy_batch`.&lt;br&gt;`renew_policy_transaction`&amp;nbsp;&lt;/div&gt;&lt;div&gt;WHERE&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;&quot;&gt;&#9;&lt;/span&gt;`policy_no` = 'SAD303438562'&amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;&quot;&gt;&#9;&lt;/span&gt;AND `renew_transaction_no` = '309202212140154851863'&amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;&quot;&gt;&#9;&lt;/span&gt;AND `status` = '1'&amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;&quot;&gt;&#9;&lt;/span&gt;LIMIT 0,1000&lt;/div&gt;" style="shape=note;size=20;whiteSpace=wrap;html=1;fontSize=16;align=left;fontFamily=Lucida Console;" parent="411" vertex="1"><mxGeometry x="1784" y="172.5" width="290" height="220" as="geometry"/></mxCell><mxCell id="559" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;" parent="411" source="560" target="558" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="602" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Lucida Console;fontSize=16;" parent="411" source="560" target="598" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="560" value="根据bill上的保单号、续期业务号[businessTransactionNo]、以及状态=[INIT(1, &quot;初始化状态&quot;)]，查询续期交易表[renew_policy_transaction]、续期交易明细表[renew_policy_transaction_detail]" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Lucida Console;fontSize=16;" parent="411" vertex="1"><mxGeometry x="2169" y="220" width="370" height="125" as="geometry"/></mxCell><mxCell id="610" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Lucida Console;fontSize=16;" parent="411" source="561" target="606" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="561" value="&lt;font face=&quot;Lucida Console&quot;&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;根据续期交易记录上的字段[renew_policy_premium_schedule_id&lt;/span&gt;&lt;/font&gt;&lt;font face=&quot;Lucida Console&quot;&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;]&lt;br&gt;&lt;/span&gt;&lt;/font&gt;&lt;span style=&quot;font-family: &amp;quot;Lucida Console&amp;quot;; font-size: 16px;&quot;&gt;查询续期相关信息(包括续期计划，缴费人信息，缴费频率，险种保费信息，险种计划,交易信息)[renew_policy_premium_schedule]表记录&lt;/span&gt;&lt;font face=&quot;Lucida Console&quot;&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="411" vertex="1"><mxGeometry x="2176.5" y="570" width="355" height="110" as="geometry"/></mxCell><mxCell id="594" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Lucida Console;fontSize=16;" parent="411" source="563" target="589" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="563" value="&lt;font face=&quot;Lucida Console&quot;&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;根据保单号、续期业务号查询bcp的bill&lt;/span&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="411" vertex="1"><mxGeometry x="2261.5" y="919" width="185" height="64" as="geometry"/></mxCell><mxCell id="574" value="续期计划上的字段[&lt;span style=&quot;text-align: left;&quot;&gt;due_date&lt;/span&gt;、&lt;span style=&quot;text-align: left;&quot;&gt;unpaid_cancel_date&lt;/span&gt;]对应的月份+1，得到变量[dueDate、unPaidCancelDate]" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Lucida Console;fontSize=16;" parent="411" vertex="1"><mxGeometry x="2195.25" y="1241" width="317.5" height="90" as="geometry"/></mxCell><mxCell id="575" value="更新保单对应的[policy_product_renew 保单缴费续期]中的[due_date]，如果是最后一期保费，同时更新[premium_status]=[FINISH_PAYMENT(4, &quot;保费缴清&quot;)]，[premium_status_change_cause]=[PREMIUM_PAY_OFF(2, &quot;保费缴清&quot;)]" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Lucida Console;fontSize=16;" parent="411" vertex="1"><mxGeometry x="2184" y="1413" width="340" height="130" as="geometry"/></mxCell><mxCell id="576" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Lucida Console;fontSize=16;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="411" source="574" target="575" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="577" value="&lt;ol&gt;&lt;li&gt;更新续期计划[renew_policy_premium_schedule]，&lt;br&gt;如果是最后一期，更新字段[prem_status]=[FINISH_PAYMENT(4, &quot;保费缴清&quot;)]，[prem_status_change_cause]=[PREMIUM_PAY_OFF(2, &quot;保费缴清&quot;)]，&lt;br&gt;如果非最后一期，更新字段[due_date]=[dueDate]，[unpaid_cancel_date]=[&lt;span style=&quot;text-align: center;&quot;&gt;unPaidCancelDate&lt;/span&gt;]&lt;/li&gt;&lt;li&gt;更新续期交易[renew_policy_transaction]，更新字段[status]=[CONFIRMED(2, &quot;确认状态&quot;)]，[due_date]=[dueDate]&lt;/li&gt;&lt;li&gt;更新续期交易明细[renew_policy_transaction_detail]，更新字段[status]=[CONFIRMED(2, &quot;确认状态&quot;)]，[due_date]=[dueDate]&lt;/li&gt;&lt;/ol&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Lucida Console;fontSize=16;align=left;" parent="411" vertex="1"><mxGeometry x="2099.9399999999996" y="1625" width="508.12" height="266" as="geometry"/></mxCell><mxCell id="578" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Lucida Console;fontSize=16;" parent="411" source="575" target="577" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="584" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Lucida Console;fontSize=16;" parent="411" source="583" target="560" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="583" value="解析kafka传递的内容，得到bill" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Lucida Console;fontSize=16;" parent="411" vertex="1"><mxGeometry x="2294" y="80" width="120" height="60" as="geometry"/></mxCell><mxCell id="595" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Lucida Console;fontSize=16;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="411" source="589" target="574" edge="1"><mxGeometry relative="1" as="geometry"><mxPoint x="2354.1" y="1208" as="targetPoint"/></mxGeometry></mxCell><mxCell id="596" value="CONFIRMED" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=16;fontFamily=Lucida Console;" parent="595" vertex="1" connectable="0"><mxGeometry x="-0.2696" relative="1" as="geometry"><mxPoint as="offset"/></mxGeometry></mxCell><mxCell id="589" value="billStatus" style="rhombus;whiteSpace=wrap;html=1;fontFamily=Lucida Console;fontSize=16;" parent="411" vertex="1"><mxGeometry x="2314" y="1064" width="80" height="80" as="geometry"/></mxCell><mxCell id="590" value="&lt;font color=&quot;#323232&quot;&gt;&lt;span style=&quot;background-color: rgba(255, 255, 255, 0.01);&quot;&gt;&lt;span style=&quot;font-size: 18px;&quot;&gt;stop&lt;/span&gt;&lt;br&gt;&lt;/span&gt;&lt;/font&gt;" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.start_2;whiteSpace=wrap;fillColor=#f8cecc;strokeColor=#b85450;fontFamily=Lucida Console;" parent="411" vertex="1"><mxGeometry x="2099.94" y="1063" width="87" height="81" as="geometry"/></mxCell><mxCell id="591" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Lucida Console;fontSize=16;" parent="411" source="589" target="590" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="592" value="ELSE" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=16;fontFamily=Lucida Console;" parent="591" vertex="1" connectable="0"><mxGeometry x="-0.2065" y="-3" relative="1" as="geometry"><mxPoint x="-7" y="1" as="offset"/></mxGeometry></mxCell><mxCell id="603" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Lucida Console;fontSize=16;" parent="411" source="598" target="561" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="604" value="NON-NULL" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=16;fontFamily=Lucida Console;" parent="603" vertex="1" connectable="0"><mxGeometry x="-0.2617" y="1" relative="1" as="geometry"><mxPoint x="1" y="3" as="offset"/></mxGeometry></mxCell><mxCell id="598" value="结果" style="rhombus;whiteSpace=wrap;html=1;fontFamily=Lucida Console;fontSize=16;" parent="411" vertex="1"><mxGeometry x="2314" y="411" width="80" height="80" as="geometry"/></mxCell><mxCell id="599" value="&lt;font color=&quot;#323232&quot;&gt;&lt;span style=&quot;background-color: rgba(255, 255, 255, 0.01);&quot;&gt;&lt;span style=&quot;font-size: 18px;&quot;&gt;stop&lt;/span&gt;&lt;br&gt;&lt;/span&gt;&lt;/font&gt;" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.start_2;whiteSpace=wrap;fillColor=#f8cecc;strokeColor=#b85450;fontFamily=Lucida Console;" parent="411" vertex="1"><mxGeometry x="2099.94" y="410" width="87" height="81" as="geometry"/></mxCell><mxCell id="600" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Lucida Console;fontSize=16;" parent="411" source="598" target="599" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="601" value="NULL" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=16;fontFamily=Lucida Console;" parent="600" vertex="1" connectable="0"><mxGeometry x="-0.2065" y="-3" relative="1" as="geometry"><mxPoint x="-7" y="1" as="offset"/></mxGeometry></mxCell><mxCell id="611" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Lucida Console;fontSize=16;" parent="411" source="606" target="563" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="612" value="NON-NULL" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=16;fontFamily=Lucida Console;" parent="611" vertex="1" connectable="0"><mxGeometry x="-0.3333" y="-3" relative="1" as="geometry"><mxPoint x="4" y="7" as="offset"/></mxGeometry></mxCell><mxCell id="606" value="结果" style="rhombus;whiteSpace=wrap;html=1;fontFamily=Lucida Console;fontSize=16;" parent="411" vertex="1"><mxGeometry x="2314" y="753" width="80" height="80" as="geometry"/></mxCell><mxCell id="607" value="&lt;font color=&quot;#323232&quot;&gt;&lt;span style=&quot;background-color: rgba(255, 255, 255, 0.01);&quot;&gt;&lt;span style=&quot;font-size: 18px;&quot;&gt;stop&lt;/span&gt;&lt;br&gt;&lt;/span&gt;&lt;/font&gt;" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.start_2;whiteSpace=wrap;fillColor=#f8cecc;strokeColor=#b85450;fontFamily=Lucida Console;" parent="411" vertex="1"><mxGeometry x="2099.94" y="751" width="87" height="81" as="geometry"/></mxCell><mxCell id="608" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Lucida Console;fontSize=16;" parent="411" source="606" target="607" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="609" value="NULL" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=16;fontFamily=Lucida Console;" parent="608" vertex="1" connectable="0"><mxGeometry x="-0.2065" y="-3" relative="1" as="geometry"><mxPoint x="-7" y="1" as="offset"/></mxGeometry></mxCell><mxCell id="426" value="policy" style="swimlane;horizontal=0;whiteSpace=wrap;html=1;fontSize=16;fontFamily=Lucida Console;" parent="1" vertex="1"><mxGeometry x="25" y="4398" width="3295" height="409" as="geometry"/></mxCell><mxCell id="457" value="/policy&lt;br&gt;/commitChangePolicy" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Lucida Console;fontSize=16;" parent="426" vertex="1"><mxGeometry x="1853.94" y="150" width="241" height="70" as="geometry"/></mxCell><mxCell id="579" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontFamily=Lucida Console;fontSize=16;exitX=1;exitY=0.5;exitDx=0;exitDy=0;dashed=1;" parent="1" source="548" target="557" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="581" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;fontFamily=Lucida Console;fontSize=16;" parent="1" source="575" target="457" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="582" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=1;entryDx=0;entryDy=0;dashed=1;fontFamily=Lucida Console;fontSize=16;" parent="1" source="563" target="420" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell></root></mxGraphModel></diagram></mxfile>