<mxfile host="drawio-plugin" modified="2022-12-21T05:44:59.657Z" agent="5.0 (Windows NT 6.2; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/104.0.5112.102 Safari/537.36" etag="RHBb9XX79HhTuLRPHM5i" version="20.5.3" type="embed"><diagram name="Page-1" id="c7558073-3199-34d8-9f00-42111426c3f3"><mxGraphModel dx="4920" dy="3380" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="826" pageHeight="1169" background="none" math="0" shadow="0"><root><mxCell id="0"/><mxCell id="1" parent="0"/><UserObject label="bcp" id="98"><mxCell style="swimlane;horizontal=0;html=1;fontFamily=Lucida Console;verticalAlign=middle;fontSize=16;align=center;whiteSpace=wrap;" parent="1" vertex="1"><mxGeometry x="20" y="762" width="3960" height="5168" as="geometry"/></mxCell></UserObject><mxCell id="485" value="" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Lucida Console;fontSize=16;" parent="98" vertex="1"><mxGeometry x="1577" y="3587" width="723" height="1453" as="geometry"/></mxCell><mxCell id="226" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="98" source="222" target="225" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="222" value="&lt;div class=&quot;mind-clipboard&quot; style=&quot;font-size: 16px;&quot;&gt;setTransType(RENEWAL(4, &quot;续期&quot;))&lt;div style=&quot;font-size: 16px;&quot;&gt;setBillStatus(PENDING(1, &quot;待处理&quot;),TRANSFER_FAILURE(7, &quot;转账失败&quot;))&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 16px;&quot;&gt;setArapAccountType(SOFT_BANK_CREDIT_CARD(115, &quot;softBank-信用卡&quot;),CASH_PAY_PAY_SJ(123, &quot;现金Pay-Pay(SJ)&quot;))&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/div&gt;&lt;div style=&quot;text-align: center; font-size: 16px;&quot;&gt;以上作为条件查询&lt;/div&gt;&lt;div style=&quot;text-align: center; font-size: 16px;&quot;&gt;bill&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;fontFamily=Lucida Console;align=left;fontSize=16;" parent="98" vertex="1"><mxGeometry x="280" y="57.809999999999995" width="440" height="166.87" as="geometry"/></mxCell><mxCell id="224" value="&lt;span style=&quot;color: rgb(16, 18, 20); font-family: &amp;quot;PingFang SC&amp;quot;, &amp;quot;Segoe UI&amp;quot;, Arial, &amp;quot;Microsoft YaHei&amp;quot;, 微软雅黑, 宋体, &amp;quot;Malgun Gothic&amp;quot;, sans-serif; font-size: 14px; text-align: start; background-color: rgb(255, 255, 255);&quot;&gt;编排调度&lt;/span&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="98" vertex="1"><mxGeometry x="90" y="56" width="120" height="30" as="geometry"/></mxCell><mxCell id="280" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="98" source="225" target="227" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="225" value="&lt;div class=&quot;mind-clipboard&quot; style=&quot;font-size: 16px;&quot;&gt;&lt;div class=&quot;mind-clipboard&quot; style=&quot;font-size: 16px;&quot;&gt;每页最大的ID，以每页limit1000为基准，分页查询，按id正序排序，取每页最后一条记录更新maxIdValue，作为下一个分页查询的条件&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;fontFamily=Lucida Console;fontSize=16;" parent="98" vertex="1"><mxGeometry x="811" y="86" width="230" height="109.25" as="geometry"/></mxCell><mxCell id="227" value="&lt;div class=&quot;mind-clipboard&quot; style=&quot;font-size: 16px;&quot;&gt;查询获取到list&lt;div style=&quot;font-size: 16px;&quot;&gt;遍历，异步处理每个object&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;absoluteArcSize=1;arcSize=14;strokeWidth=2;fontFamily=Lucida Console;fontSize=16;" parent="98" vertex="1"><mxGeometry x="1120" y="96.25" width="150" height="90" as="geometry"/></mxCell><mxCell id="221" value="&lt;font color=&quot;#323232&quot;&gt;&lt;span style=&quot;background-color: rgba(255, 255, 255, 0.01);&quot;&gt;&lt;span style=&quot;font-size: 18px;&quot;&gt;续期扣款&lt;/span&gt;&lt;br&gt;&lt;span style=&quot;font-size: 18px;&quot;&gt;renewAuthory&lt;br&gt;Schedule&lt;/span&gt;&lt;br&gt;&lt;/span&gt;&lt;/font&gt;" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.start_2;whiteSpace=wrap;fillColor=#f8cecc;strokeColor=#b85450;fontFamily=Lucida Console;" parent="98" vertex="1"><mxGeometry x="106.5" y="100.75" width="87" height="81" as="geometry"/></mxCell><mxCell id="223" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="98" source="221" target="222" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="253" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;entryPerimeter=0;fontFamily=Lucida Console;fontSize=16;" parent="98" source="251" target="252" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="251" value="&lt;span style=&quot;color: rgb(50, 50, 50); font-size: 16px; background-color: rgba(255, 255, 255, 0.01);&quot;&gt;dueDate计算出的最后缴费日期[lastPaymentDate]，计算方法是取dueDate的月份-1的月末23:59:59日期&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=16;fontFamily=Lucida Console;" parent="98" vertex="1"><mxGeometry x="1262.51" y="288" width="224.99" height="92" as="geometry"/></mxCell><mxCell id="255" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;entryPerimeter=0;fontFamily=Lucida Console;fontSize=16;" parent="98" source="252" target="254" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="256" value="大于" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=16;fontFamily=Lucida Console;" parent="255" vertex="1" connectable="0"><mxGeometry x="-0.1752" y="-1" relative="1" as="geometry"><mxPoint as="offset"/></mxGeometry></mxCell><mxCell id="264" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontFamily=Lucida Console;fontSize=16;" parent="98" source="252" target="263" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="265" value="小于等于" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=16;fontFamily=Lucida Console;" parent="264" vertex="1" connectable="0"><mxGeometry x="-0.2444" y="-2" relative="1" as="geometry"><mxPoint as="offset"/></mxGeometry></mxCell><mxCell id="252" value="&lt;span style=&quot;color: rgb(50, 50, 50); font-size: 16px; background-color: rgba(255, 255, 255, 0.01);&quot;&gt;bizTime comapre&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(50, 50, 50); font-family: 微软雅黑; font-size: 16px; background-color: rgba(255, 255, 255, 0.01);&quot;&gt;lastPaymentDate&lt;/span&gt;&lt;span style=&quot;color: rgb(50, 50, 50); font-size: 16px; background-color: rgba(255, 255, 255, 0.01);&quot;&gt;&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.decision;whiteSpace=wrap;fontFamily=Lucida Console;fontSize=16;" parent="98" vertex="1"><mxGeometry x="1338.13" y="468" width="73.75" height="60" as="geometry"/></mxCell><mxCell id="254" value="&lt;font color=&quot;#323232&quot;&gt;&lt;span style=&quot;background-color: rgba(255, 255, 255, 0.01);&quot;&gt;&lt;span style=&quot;font-size: 18px;&quot;&gt;stop&lt;/span&gt;&lt;br&gt;&lt;/span&gt;&lt;/font&gt;" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.start_2;whiteSpace=wrap;fillColor=#f8cecc;strokeColor=#b85450;fontFamily=Lucida Console;" parent="98" vertex="1"><mxGeometry x="1132" y="457.5" width="87" height="81" as="geometry"/></mxCell><mxCell id="262" value="比如dueDate是2022年12月12日，那么lastpaymentDate计算出便来2022-11-30 23:59:59" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontFamily=Lucida Console;fontSize=16;" parent="98" vertex="1"><mxGeometry x="1010" y="350" width="250" height="50" as="geometry"/></mxCell><mxCell id="292" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;entryPerimeter=0;fontFamily=Lucida Console;fontSize=16;" parent="98" source="263" target="290" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="263" value="查询保单详情" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Lucida Console;fontSize=16;" parent="98" vertex="1"><mxGeometry x="1312.5" y="618" width="125" height="42" as="geometry"/></mxCell><mxCell id="272" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;fontFamily=Lucida Console;fontSize=16;dashed=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;" parent="98" source="266" target="268" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="274" style="edgeStyle=none;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontFamily=Lucida Console;fontSize=16;" parent="98" source="266" target="273" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="266" value="&lt;span style=&quot;color: rgb(50, 50, 50); font-family: 微软雅黑; background-color: rgba(255, 255, 255, 0.01);&quot;&gt;查询保单bcp相关记录详情&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Lucida Console;fontSize=16;" parent="98" vertex="1"><mxGeometry x="1306.26" y="906" width="137.49" height="52" as="geometry"/></mxCell><mxCell id="268" value="&lt;span style=&quot;color: rgb(50, 50, 50); font-family: 微软雅黑; font-weight: 400; background-color: rgba(255, 255, 255, 0.01);&quot;&gt;查询保单bcp相关记录详情&lt;/span&gt;" style="swimlane;whiteSpace=wrap;html=1;fontFamily=Lucida Console;fontSize=16;" parent="98" vertex="1"><mxGeometry x="110" y="667" width="900" height="292" as="geometry"/></mxCell><mxCell id="269" value="&lt;div class=&quot;mind-clipboard&quot;&gt;SELECT&lt;div&gt;&lt;/div&gt;*&lt;div&gt;&lt;/div&gt;FROM&lt;div&gt;&lt;/div&gt;bill &lt;div&gt;&lt;/div&gt;WHERE&lt;div&gt;&lt;/div&gt;1 = 1 &lt;div&gt;&lt;/div&gt;AND policy_no = 'SAH300240007' &lt;div&gt;&lt;/div&gt;AND trans_type = 4 &lt;div&gt;&lt;/div&gt;AND bill_status IN ( 1, 7 ) &lt;div&gt;&lt;/div&gt;AND payee_id IN ( 9559386 ) &lt;div&gt;&lt;/div&gt;AND is_deleted = 'N'&lt;/div&gt;" style="shape=note;size=20;whiteSpace=wrap;html=1;fontFamily=Lucida Console;fontSize=16;align=left;" parent="268" vertex="1"><mxGeometry x="10" y="39.5" width="280" height="240.5" as="geometry"/></mxCell><mxCell id="270" value="&lt;div class=&quot;mind-clipboard&quot;&gt;&lt;div class=&quot;mind-clipboard&quot;&gt;SELECT&lt;div&gt;&lt;/div&gt;*&lt;div&gt;&lt;/div&gt;FROM&lt;div&gt;&lt;/div&gt;receivable_payable &lt;div&gt;&lt;/div&gt;WHERE&lt;div&gt;&lt;/div&gt;1 = 1 &lt;div&gt;&lt;/div&gt;AND bill_id = 9703721 &lt;div&gt;&lt;/div&gt;AND policy_no = 'SAH300240007' &lt;div&gt;&lt;/div&gt;AND payee_id = 9559386&amp;nbsp;&amp;nbsp;&lt;div&gt;&lt;/div&gt;AND is_deleted = 'N'&lt;/div&gt;&lt;/div&gt;" style="shape=note;size=20;whiteSpace=wrap;html=1;fontFamily=Lucida Console;fontSize=16;align=left;" parent="268" vertex="1"><mxGeometry x="310" y="39.5" width="280" height="240.5" as="geometry"/></mxCell><mxCell id="271" value="&lt;div class=&quot;mind-clipboard&quot;&gt;&lt;div class=&quot;mind-clipboard&quot;&gt;SELECT&lt;div&gt;&lt;/div&gt;* &lt;div&gt;&lt;/div&gt;FROM&lt;div&gt;&lt;/div&gt;bcp_ext_info &lt;div&gt;&lt;/div&gt;WHERE&lt;div&gt;&lt;/div&gt;1 = 1 &lt;div&gt;&lt;/div&gt;AND bill_id = 9703721 &lt;div&gt;&lt;/div&gt;AND is_deleted = 'N'&lt;/div&gt;&lt;/div&gt;" style="shape=note;size=20;whiteSpace=wrap;html=1;fontFamily=Lucida Console;fontSize=16;align=left;" parent="268" vertex="1"><mxGeometry x="606" y="69.5" width="282" height="180.5" as="geometry"/></mxCell><mxCell id="276" style="edgeStyle=none;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0;entryDx=200;entryDy=95;entryPerimeter=0;dashed=1;fontFamily=Lucida Console;fontSize=16;" parent="98" source="273" target="275" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="279" style="edgeStyle=none;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Lucida Console;fontSize=16;" parent="98" source="273" target="277" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="273" value="&lt;font face=&quot;微软雅黑&quot; color=&quot;#323232&quot;&gt;&lt;span style=&quot;background-color: rgba(255, 255, 255, 0.01);&quot;&gt;查询支付方式配置&lt;/span&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Lucida Console;fontSize=16;" parent="98" vertex="1"><mxGeometry x="1303.14" y="1036" width="143.74" height="42" as="geometry"/></mxCell><mxCell id="275" value="&lt;div class=&quot;mind-clipboard&quot;&gt;SELECT&lt;div&gt;&lt;/div&gt;*&lt;div&gt;&lt;/div&gt;FROM&lt;div&gt;&lt;/div&gt;payment_config &lt;div&gt;&lt;/div&gt;WHERE&lt;div&gt;&lt;/div&gt;1 = 1 &lt;div&gt;&lt;/div&gt;AND pay_method = 123 &lt;div&gt;&lt;/div&gt;AND is_deleted = 'N'&lt;/div&gt;" style="shape=note;size=20;whiteSpace=wrap;html=1;fontFamily=Lucida Console;fontSize=16;align=left;" parent="98" vertex="1"><mxGeometry x="826" y="1011" width="200" height="170" as="geometry"/></mxCell><mxCell id="283" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="98" source="277" target="281" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="284" value="&lt;font face=&quot;Lucida Console&quot; style=&quot;font-size: 16px;&quot;&gt;ELSE&lt;/font&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="283" vertex="1" connectable="0"><mxGeometry x="-0.266" relative="1" as="geometry"><mxPoint x="-36" y="37" as="offset"/></mxGeometry></mxCell><mxCell id="285" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontFamily=Lucida Console;fontSize=16;" parent="98" source="277" target="282" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="286" value="NEED_NOW_PAY" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=16;fontFamily=Lucida Console;" parent="285" vertex="1" connectable="0"><mxGeometry x="-0.3268" y="1" relative="1" as="geometry"><mxPoint x="35" y="38" as="offset"/></mxGeometry></mxCell><mxCell id="277" value="&lt;span style=&quot;color: rgb(50, 50, 50); font-size: 16px; background-color: rgba(255, 255, 255, 0.01);&quot;&gt;支付类型&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.decision;whiteSpace=wrap;fontFamily=Lucida Console;fontSize=16;" parent="98" vertex="1"><mxGeometry x="1338.14" y="1149" width="73.75" height="60" as="geometry"/></mxCell><mxCell id="289" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;entryPerimeter=0;fontFamily=Lucida Console;fontSize=16;" parent="98" source="281" target="288" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="281" value="&lt;span style=&quot;color: rgb(50, 50, 50); font-family: 微软雅黑; background-color: rgba(255, 255, 255, 0.01);&quot;&gt;confirmRenewBill&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Lucida Console;fontSize=16;" parent="98" vertex="1"><mxGeometry x="1159.4" y="1266" width="143.74" height="42" as="geometry"/></mxCell><mxCell id="287" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;fontFamily=Lucida Console;fontSize=16;" parent="98" source="282" target="281" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="282" value="&lt;font face=&quot;微软雅黑&quot; color=&quot;#323232&quot;&gt;&lt;span style=&quot;background-color: rgba(255, 255, 255, 0.01);&quot;&gt;调用PAYPAY扣款&lt;/span&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Lucida Console;fontSize=16;" parent="98" vertex="1"><mxGeometry x="1437.5" y="1266" width="143.74" height="42" as="geometry"/></mxCell><mxCell id="288" value="&lt;font color=&quot;#323232&quot;&gt;&lt;span style=&quot;background-color: rgba(255, 255, 255, 0.01);&quot;&gt;&lt;span style=&quot;font-size: 18px;&quot;&gt;stop&lt;/span&gt;&lt;br&gt;&lt;/span&gt;&lt;/font&gt;" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.start_2;whiteSpace=wrap;fillColor=#f8cecc;strokeColor=#b85450;fontFamily=Lucida Console;" parent="98" vertex="1"><mxGeometry x="1187.77" y="1374" width="87" height="81" as="geometry"/></mxCell><mxCell id="291" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontFamily=Lucida Console;fontSize=16;" parent="98" source="290" target="266" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="296" value="有效" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=16;fontFamily=Lucida Console;" parent="291" vertex="1" connectable="0"><mxGeometry x="-0.3188" y="-2" relative="1" as="geometry"><mxPoint y="1" as="offset"/></mxGeometry></mxCell><mxCell id="297" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;entryPerimeter=0;fontFamily=Lucida Console;fontSize=16;" parent="98" source="290" target="293" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="298" value="无效" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=16;fontFamily=Lucida Console;" parent="297" vertex="1" connectable="0"><mxGeometry x="-0.2307" y="-3" relative="1" as="geometry"><mxPoint as="offset"/></mxGeometry></mxCell><mxCell id="290" value="&lt;span style=&quot;color: rgb(50, 50, 50); font-size: 16px; background-color: rgba(255, 255, 255, 0.01);&quot;&gt;保单状态&lt;/span&gt;&lt;span style=&quot;color: rgb(50, 50, 50); font-size: 16px; background-color: rgba(255, 255, 255, 0.01);&quot;&gt;&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.decision;whiteSpace=wrap;fontFamily=Lucida Console;fontSize=16;" parent="98" vertex="1"><mxGeometry x="1338.13" y="749" width="73.75" height="60" as="geometry"/></mxCell><mxCell id="293" value="&lt;font color=&quot;#323232&quot;&gt;&lt;span style=&quot;background-color: rgba(255, 255, 255, 0.01);&quot;&gt;&lt;span style=&quot;font-size: 18px;&quot;&gt;stop&lt;/span&gt;&lt;br&gt;&lt;/span&gt;&lt;/font&gt;" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.start_2;whiteSpace=wrap;fillColor=#f8cecc;strokeColor=#b85450;fontFamily=Lucida Console;" parent="98" vertex="1"><mxGeometry x="1132" y="738.5" width="87" height="81" as="geometry"/></mxCell><mxCell id="303" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;entryPerimeter=0;fontFamily=Lucida Console;fontSize=16;" parent="98" source="299" target="302" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="350" style="edgeStyle=none;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;entryPerimeter=0;dashed=1;" parent="98" source="299" target="348" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="299" value="&lt;span style=&quot;color: rgb(50, 50, 50); font-family: 微软雅黑; background-color: rgba(255, 255, 255, 0.01);&quot;&gt;查询续期(续保)交易流水号（续期抽档时塞进去的）&lt;/span&gt;" style="rounded=1;html=1;fontFamily=Lucida Console;fontSize=16;whiteSpace=wrap;" parent="98" vertex="1"><mxGeometry x="2377" y="1088" width="190" height="72" as="geometry"/></mxCell><mxCell id="307" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontFamily=Lucida Console;fontSize=16;" parent="98" source="302" target="317" edge="1"><mxGeometry relative="1" as="geometry"><mxPoint x="2692" y="1387" as="targetPoint"/></mxGeometry></mxCell><mxCell id="309" value="TRANSFER_FAILURE" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=16;fontFamily=Lucida Console;" parent="307" vertex="1" connectable="0"><mxGeometry x="0.3811" relative="1" as="geometry"><mxPoint as="offset"/></mxGeometry></mxCell><mxCell id="402" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontFamily=Lucida Console;fontSize=18;" parent="98" source="302" target="362" edge="1"><mxGeometry relative="1" as="geometry"><Array as="points"><mxPoint x="2200" y="1247"/><mxPoint x="2200" y="2403"/></Array></mxGeometry></mxCell><mxCell id="403" value="ELSE" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=18;fontFamily=Lucida Console;" parent="402" vertex="1" connectable="0"><mxGeometry x="-0.7077" y="-2" relative="1" as="geometry"><mxPoint x="2" y="16" as="offset"/></mxGeometry></mxCell><mxCell id="302" value="&lt;span style=&quot;color: rgb(50, 50, 50); font-size: 16px; background-color: rgba(255, 255, 255, 0.01);&quot;&gt;bill的status&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.decision;whiteSpace=wrap;fontFamily=Lucida Console;fontSize=16;" parent="98" vertex="1"><mxGeometry x="2435.12" y="1217" width="73.75" height="60" as="geometry"/></mxCell><mxCell id="323" style="edgeStyle=none;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontFamily=Lucida Console;fontSize=16;" parent="98" source="317" target="318" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="328" style="edgeStyle=none;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;entryPerimeter=0;dashed=1;fontFamily=Lucida Console;fontSize=16;" parent="98" source="317" target="327" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="317" value="&lt;span style=&quot;color: rgb(50, 50, 50); font-family: 微软雅黑; background-color: rgba(255, 255, 255, 0.01);&quot;&gt;根据保单号以及支付流水号查询[third_party_transaction_record 调用第三方接口详情记录表]，根据gmtCreated字段倒叙排序，获取最新的一条记录，记为record&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Lucida Console;fontSize=16;" parent="98" vertex="1"><mxGeometry x="2867" y="1527" width="250" height="122" as="geometry"/></mxCell><mxCell id="329" style="edgeStyle=none;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0;entryDx=250;entryDy=151;entryPerimeter=0;dashed=1;fontFamily=Lucida Console;fontSize=16;exitX=0;exitY=0.5;exitDx=0;exitDy=0;" parent="98" source="318" target="324" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="331" style="edgeStyle=none;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;entryPerimeter=0;fontFamily=Lucida Console;fontSize=16;" parent="98" source="318" target="330" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="318" value="&lt;span style=&quot;color: rgb(50, 50, 50); font-family: 微软雅黑; background-color: rgba(255, 255, 255, 0.01);&quot;&gt;系统配置有第三方返回结果标识，调用记录record中的code字段是否包含在系统配置中&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Verdana;fontSize=16;" parent="98" vertex="1"><mxGeometry x="2882" y="1738" width="220" height="72" as="geometry"/></mxCell><mxCell id="324" value="&lt;div style=&quot;font-size: 12px;&quot;&gt;400|INVALID_REQUEST_PARAMS&lt;/div&gt;&lt;div style=&quot;font-size: 12px;&quot;&gt;401|OP_OUT_OF_SCOPE&lt;/div&gt;&lt;div style=&quot;font-size: 12px;&quot;&gt;400|MISSING_REQUEST_PARAMS&lt;/div&gt;&lt;div style=&quot;font-size: 12px;&quot;&gt;400|INVALID_PARAMS&lt;/div&gt;&lt;div style=&quot;font-size: 12px;&quot;&gt;401|UNAUTHORIZED&lt;/div&gt;&lt;div style=&quot;font-size: 12px;&quot;&gt;401|INVALID_USER_AUTHORIZATION_ID&lt;/div&gt;&lt;div style=&quot;font-size: 12px;&quot;&gt;401|EXPIRED_USER_AUTHORIZATION_ID&lt;/div&gt;&lt;div style=&quot;font-size: 12px;&quot;&gt;404|OPA_CLIENT_NOT_FOUND&lt;/div&gt;&lt;div style=&quot;font-size: 12px;&quot;&gt;429|RATE_LIMIT&lt;/div&gt;&lt;div style=&quot;font-size: 12px;&quot;&gt;400|CC_LIMIT_EXCEEDED&lt;/div&gt;&lt;div style=&quot;font-size: 12px;&quot;&gt;400|PPC_BAD_REQUEST&lt;/div&gt;&lt;div style=&quot;font-size: 12px;&quot;&gt;400|PPC_EXPIRED&lt;/div&gt;&lt;div style=&quot;font-size: 12px;&quot;&gt;400|PPC_LIMIT_EXCEEDED&lt;/div&gt;&lt;div style=&quot;font-size: 12px;&quot;&gt;400|SUSPECTED_DUPLICATE_PAYMENT&lt;/div&gt;&lt;div style=&quot;font-size: 12px;&quot;&gt;400|UNACCEPTABLE_OP&lt;/div&gt;&lt;div style=&quot;font-size: 12px;&quot;&gt;400|NON_KYC_USER&lt;/div&gt;&lt;div style=&quot;font-size: 12px;&quot;&gt;400|NO_SUFFICIENT_FUND&lt;/div&gt;&lt;div style=&quot;font-size: 12px;&quot;&gt;404|RESOURCE_NOT_FOUND&lt;/div&gt;&lt;div style=&quot;font-size: 12px;&quot;&gt;500|TRANSACTION_FAILED&lt;/div&gt;" style="shape=note;size=20;whiteSpace=wrap;html=1;fontSize=12;fontFamily=Lucida Console;align=left;" parent="98" vertex="1"><mxGeometry x="2427" y="1618" width="250" height="282" as="geometry"/></mxCell><mxCell id="327" value="&lt;div class=&quot;mind-clipboard&quot;&gt;&lt;div class=&quot;mind-clipboard&quot;&gt;SELECT&lt;div&gt;&lt;/div&gt;* &lt;div&gt;&lt;/div&gt;FROM&lt;div&gt;&lt;/div&gt;sj_gr_bcp.third_party_transaction_record &lt;div&gt;&lt;/div&gt;WHERE&lt;div&gt;&lt;/div&gt;1 = 1 &lt;div&gt;&lt;/div&gt;AND policy_no = 'SAF300247092' &lt;div&gt;&lt;/div&gt;AND transaction_no = '309202210100141671321' &lt;div&gt;&lt;/div&gt;AND is_deleted = 'N'&lt;/div&gt;&lt;/div&gt;" style="shape=note;size=20;whiteSpace=wrap;html=1;fontFamily=Verdana;fontSize=16;align=left;" parent="98" vertex="1"><mxGeometry x="3197" y="1455" width="350" height="212" as="geometry"/></mxCell><mxCell id="336" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Lucida Console;fontSize=16;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="98" source="330" target="332" edge="1"><mxGeometry relative="1" as="geometry"><mxPoint x="2753.75" y="1918" as="targetPoint"/></mxGeometry></mxCell><mxCell id="337" value="包含" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=16;fontFamily=Lucida Console;" parent="336" vertex="1" connectable="0"><mxGeometry x="0.0908" y="-6" relative="1" as="geometry"><mxPoint x="10" y="5" as="offset"/></mxGeometry></mxCell><mxCell id="341" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontFamily=Lucida Console;fontSize=16;exitX=1;exitY=0.5;exitDx=0;exitDy=0;exitPerimeter=0;" parent="98" source="330" target="339" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="342" value="不包含" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=16;fontFamily=Lucida Console;" parent="341" vertex="1" connectable="0"><mxGeometry x="-0.1596" y="3" relative="1" as="geometry"><mxPoint x="10" as="offset"/></mxGeometry></mxCell><mxCell id="330" value="&lt;span style=&quot;color: rgb(50, 50, 50); font-size: 16px; background-color: rgba(255, 255, 255, 0.01);&quot;&gt;code in&lt;br&gt;SystemConfig&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.decision;whiteSpace=wrap;fontFamily=Lucida Console;fontSize=16;" parent="98" vertex="1"><mxGeometry x="2955.12" y="1888" width="73.75" height="60" as="geometry"/></mxCell><mxCell id="347" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;dashed=1;" parent="98" source="332" target="344" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="358" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;entryPerimeter=0;fontFamily=Lucida Console;fontSize=16;" parent="98" source="339" target="356" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="339" value="&lt;div class=&quot;mind-clipboard&quot;&gt;&lt;/div&gt;&lt;span style=&quot;color: rgb(50, 50, 50); font-family: 微软雅黑; background-color: rgba(255, 255, 255, 0.01);&quot;&gt;operatorType=[&lt;/span&gt;&lt;font face=&quot;微软雅黑&quot; color=&quot;#323232&quot;&gt;PAYPAY_SETTLE_QUERY(&quot;通过PayPal查询结算结果&quot;)&lt;/font&gt;&lt;span style=&quot;background-color: rgba(255, 255, 255, 0.01); color: rgb(50, 50, 50); font-family: 微软雅黑;&quot;&gt;]，&lt;/span&gt;&lt;span style=&quot;color: rgb(50, 50, 50); font-family: 微软雅黑; background-color: rgba(255, 255, 255, 0.01);&quot;&gt;根据之前的交易流水号查询支付结果&lt;/span&gt;&lt;font face=&quot;微软雅黑&quot; color=&quot;#323232&quot;&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Verdana;fontSize=16;" parent="98" vertex="1"><mxGeometry x="3107.51" y="1973" width="233" height="82" as="geometry"/></mxCell><mxCell id="344" value="" style="rounded=1;whiteSpace=wrap;html=1;dashed=1;" parent="98" vertex="1"><mxGeometry x="2270" y="1987" width="270" height="292" as="geometry"/></mxCell><mxCell id="345" value="&lt;div style=&quot;font-size: 12px;&quot;&gt;&lt;div class=&quot;mind-clipboard&quot;&gt;UPDATE sj_gr_bcp.bill &lt;div&gt;&lt;/div&gt;SET third_party_tracking_id = 309202211140142259961,&lt;div&gt;&lt;/div&gt;gmt_modified = CURRENT_TIMESTAMP ( 3 ) &lt;div&gt;&lt;/div&gt;WHERE&lt;div&gt;&lt;/div&gt;id = 9710738 &lt;div&gt;&lt;/div&gt;AND payee_id = 9561542&lt;/div&gt;&lt;/div&gt;" style="shape=note;size=20;whiteSpace=wrap;html=1;fontSize=12;fontFamily=Lucida Console;align=left;" parent="98" vertex="1"><mxGeometry x="2285" y="2007" width="240" height="132" as="geometry"/></mxCell><mxCell id="346" value="&lt;div style=&quot;font-size: 12px;&quot;&gt;&lt;div class=&quot;mind-clipboard&quot;&gt;&lt;div class=&quot;mind-clipboard&quot;&gt;UPDATE bcp_ext_info &lt;div&gt;&lt;/div&gt;SET ext_value = 309202211140142259961,&lt;div&gt;&lt;/div&gt;gmt_modified = now() &lt;div&gt;&lt;/div&gt;WHERE&lt;div&gt;&lt;/div&gt;id = 9277382&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="shape=note;size=20;whiteSpace=wrap;html=1;fontSize=12;fontFamily=Lucida Console;align=left;" parent="98" vertex="1"><mxGeometry x="2285" y="2157" width="240" height="102" as="geometry"/></mxCell><mxCell id="348" value="&lt;div style=&quot;font-size: 14px;&quot;&gt;&lt;div class=&quot;mind-clipboard&quot; style=&quot;font-size: 14px;&quot;&gt;&lt;div class=&quot;mind-clipboard&quot; style=&quot;font-size: 14px;&quot;&gt;SELECT&lt;div style=&quot;font-size: 14px;&quot;&gt;&lt;/div&gt;* &lt;div style=&quot;font-size: 14px;&quot;&gt;&lt;/div&gt;FROM&lt;div style=&quot;font-size: 14px;&quot;&gt;&lt;/div&gt;bcp_ext_info &lt;div style=&quot;font-size: 14px;&quot;&gt;&lt;/div&gt;WHERE&lt;div style=&quot;font-size: 14px;&quot;&gt;&lt;/div&gt;1 = 1 &lt;div style=&quot;font-size: 14px;&quot;&gt;&lt;/div&gt;AND bill_id = 9703721 &lt;div style=&quot;font-size: 14px;&quot;&gt;&lt;/div&gt;AND ext_key = 'thirdPartyTrackingId' &lt;div style=&quot;font-size: 14px;&quot;&gt;&lt;/div&gt;AND is_deleted = 'N';&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="shape=note;size=20;whiteSpace=wrap;html=1;fontSize=14;fontFamily=Lucida Console;align=left;" parent="98" vertex="1"><mxGeometry x="2637" y="1036" width="193" height="177" as="geometry"/></mxCell><mxCell id="360" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;exitPerimeter=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;entryPerimeter=0;fontFamily=Lucida Console;fontSize=16;" parent="98" source="356" target="359" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="361" value="成功" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=16;fontFamily=Lucida Console;" parent="360" vertex="1" connectable="0"><mxGeometry x="0.2244" y="1" relative="1" as="geometry"><mxPoint y="-9" as="offset"/></mxGeometry></mxCell><mxCell id="368" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;exitPerimeter=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;fontFamily=Lucida Console;fontSize=18;" parent="98" source="356" target="332" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="369" value="失败" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=18;fontFamily=Lucida Console;" parent="368" vertex="1" connectable="0"><mxGeometry x="0.1379" y="-5" relative="1" as="geometry"><mxPoint x="7" y="4" as="offset"/></mxGeometry></mxCell><mxCell id="356" value="&lt;span style=&quot;color: rgb(50, 50, 50); font-size: 16px; background-color: rgba(255, 255, 255, 0.01);&quot;&gt;支付结果&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.decision;whiteSpace=wrap;fontFamily=Lucida Console;fontSize=16;" parent="98" vertex="1"><mxGeometry x="3187.13" y="2131" width="73.75" height="60" as="geometry"/></mxCell><mxCell id="359" value="&lt;font color=&quot;#323232&quot;&gt;&lt;span style=&quot;background-color: rgba(255, 255, 255, 0.01);&quot;&gt;&lt;span style=&quot;font-size: 18px;&quot;&gt;stop&lt;/span&gt;&lt;br&gt;&lt;/span&gt;&lt;/font&gt;" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.start_2;whiteSpace=wrap;fillColor=#f8cecc;strokeColor=#b85450;fontFamily=Lucida Console;" parent="98" vertex="1"><mxGeometry x="3180.51" y="2268" width="87" height="81" as="geometry"/></mxCell><mxCell id="375" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;entryPerimeter=0;dashed=1;fontFamily=Lucida Console;fontSize=18;" parent="98" source="362" target="374" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="362" value="&lt;span style=&quot;color: rgb(50, 50, 50); font-family: 微软雅黑; background-color: rgba(255, 255, 255, 0.01);&quot;&gt;operatorType=[&lt;/span&gt;&lt;span style=&quot;background-color: rgba(255, 255, 255, 0.01);&quot;&gt;&lt;font face=&quot;微软雅黑&quot; color=&quot;#323232&quot;&gt;PAY_FROM_PAYPAY(&quot;通过PayPal支付&quot;)]，&lt;/font&gt;&lt;/span&gt;调用PAYPAY支付" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Verdana;fontSize=16;" parent="98" vertex="1"><mxGeometry x="2637" y="2368" width="240" height="69" as="geometry"/></mxCell><mxCell id="372" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontFamily=Lucida Console;fontSize=18;" parent="98" source="332" target="362" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="332" value="&lt;div class=&quot;mind-clipboard&quot;&gt;&lt;span style=&quot;font-size: inherit;&quot;&gt;生成新的续期交易流水号，并更新到bill以及extInfo表中&lt;/span&gt;&lt;br&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Verdana;fontSize=16;" parent="98" vertex="1"><mxGeometry x="2647" y="2135" width="220" height="52" as="geometry"/></mxCell><mxCell id="378" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;exitPerimeter=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontFamily=Lucida Console;fontSize=18;" parent="98" source="374" target="376" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="380" value="失败" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=18;fontFamily=Lucida Console;" parent="378" vertex="1" connectable="0"><mxGeometry x="0.0463" y="-1" relative="1" as="geometry"><mxPoint x="7" as="offset"/></mxGeometry></mxCell><mxCell id="379" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;exitPerimeter=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontFamily=Lucida Console;fontSize=18;" parent="98" source="374" target="382" edge="1"><mxGeometry relative="1" as="geometry"><mxPoint x="2987" y="2628" as="targetPoint"/></mxGeometry></mxCell><mxCell id="381" value="成功" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=18;fontFamily=Lucida Console;" parent="379" vertex="1" connectable="0"><mxGeometry x="-0.0252" y="2" relative="1" as="geometry"><mxPoint as="offset"/></mxGeometry></mxCell><mxCell id="374" value="&lt;span style=&quot;color: rgb(50, 50, 50); font-size: 16px; background-color: rgba(255, 255, 255, 0.01);&quot;&gt;支付结果&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.decision;whiteSpace=wrap;fontFamily=Lucida Console;fontSize=16;" parent="98" vertex="1"><mxGeometry x="2720.12" y="2518" width="73.75" height="60" as="geometry"/></mxCell><mxCell id="384" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;entryPerimeter=0;fontFamily=Lucida Console;fontSize=18;" parent="98" source="376" target="383" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="376" value="&lt;div class=&quot;mind-clipboard&quot;&gt;&lt;font&gt;[bill]的状态改为&lt;br&gt;[TRANSFER_FAILURE(7, &quot;转账失败&quot;)]，插入[third_party_transaction_record]数据，更新[bcp_ext_info]的字段[feeStatus]=[2 失败]&lt;/font&gt;&lt;br&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Lucida Console;fontSize=16;" parent="98" vertex="1"><mxGeometry x="2397" y="2628" width="340" height="102" as="geometry"/></mxCell><mxCell id="409" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontFamily=Lucida Console;fontSize=14;dashed=1;" parent="98" source="382" target="404" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="382" value="&lt;div class=&quot;mind-clipboard&quot;&gt;bcp表更新(更新bill(状态不更新)、更新余额、插入实收[CONFIRMED]、更新extInfo)&lt;br&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Lucida Console;fontSize=16;" parent="98" vertex="1"><mxGeometry x="2847" y="2638" width="213" height="102" as="geometry"/></mxCell><mxCell id="386" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;entryPerimeter=0;fontFamily=Lucida Console;fontSize=18;" parent="98" source="383" target="385" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="387" value="ELSE" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=18;fontFamily=Lucida Console;" parent="386" vertex="1" connectable="0"><mxGeometry x="-0.1956" y="4" relative="1" as="geometry"><mxPoint as="offset"/></mxGeometry></mxCell><mxCell id="391" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;entryPerimeter=0;fontFamily=Lucida Console;fontSize=18;" parent="98" source="383" target="390" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="392" value="续保" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=18;fontFamily=Lucida Console;" parent="391" vertex="1" connectable="0"><mxGeometry x="-0.0812" y="-2" relative="1" as="geometry"><mxPoint as="offset"/></mxGeometry></mxCell><mxCell id="383" value="&lt;span style=&quot;color: rgb(50, 50, 50); font-size: 16px; background-color: rgba(255, 255, 255, 0.01);&quot;&gt;bill的transType&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.decision;whiteSpace=wrap;fontFamily=Lucida Console;fontSize=16;" parent="98" vertex="1"><mxGeometry x="2530.13" y="2818" width="73.75" height="60" as="geometry"/></mxCell><mxCell id="385" value="&lt;font color=&quot;#323232&quot;&gt;&lt;span style=&quot;background-color: rgba(255, 255, 255, 0.01);&quot;&gt;&lt;span style=&quot;font-size: 18px;&quot;&gt;stop&lt;/span&gt;&lt;br&gt;&lt;/span&gt;&lt;/font&gt;" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.start_2;whiteSpace=wrap;fillColor=#f8cecc;strokeColor=#b85450;fontFamily=Lucida Console;" parent="98" vertex="1"><mxGeometry x="2687" y="2938" width="87" height="81" as="geometry"/></mxCell><mxCell id="389" value="&lt;span style=&quot;color: rgb(50, 50, 50); font-family: 微软雅黑; font-size: 16px; background-color: rgba(255, 255, 255, 0.01);&quot;&gt;判断bill上的transType如果不等于[RENEWAL_POLICY(7, &quot;续保&quot;)]&lt;/span&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;dashed=1;fontFamily=Lucida Console;fontSize=18;" parent="98" vertex="1"><mxGeometry x="2317" y="2766" width="250" height="52" as="geometry"/></mxCell><mxCell id="395" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontFamily=Lucida Console;fontSize=18;" parent="98" source="390" target="393" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="397" value="&lt;span style=&quot;font-size: 16px; background-color: rgb(248, 249, 250);&quot;&gt;每月的27号16点&lt;/span&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=18;fontFamily=Lucida Console;" parent="395" vertex="1" connectable="0"><mxGeometry x="-0.1907" y="-1" relative="1" as="geometry"><mxPoint x="21" y="1" as="offset"/></mxGeometry></mxCell><mxCell id="396" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontFamily=Lucida Console;fontSize=18;" parent="98" source="390" target="394" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="398" value="&lt;span style=&quot;font-size: 16px; background-color: rgb(248, 249, 250);&quot;&gt;每月最后一天的16点&lt;/span&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=18;fontFamily=Lucida Console;" parent="396" vertex="1" connectable="0"><mxGeometry x="-0.4185" y="-2" relative="1" as="geometry"><mxPoint y="-3" as="offset"/></mxGeometry></mxCell><mxCell id="390" value="&lt;span style=&quot;color: rgb(50, 50, 50); font-size: 16px; background-color: rgba(255, 255, 255, 0.01);&quot;&gt;bizTime&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.decision;whiteSpace=wrap;fontFamily=Lucida Console;fontSize=16;" parent="98" vertex="1"><mxGeometry x="2317" y="2948.5" width="73.75" height="60" as="geometry"/></mxCell><mxCell id="400" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;entryPerimeter=0;fontFamily=Lucida Console;fontSize=18;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="98" source="393" target="399" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="393" value="&lt;div class=&quot;mind-clipboard&quot;&gt;每月的27号16点（第四次扣款依然失败）businessType=[FEE_APPLICATION_FAILED(76, &quot;月額課金（サブスク）翌月分ご請求失敗時&quot;)]，template=[月額課金（サブスク）翌月分ご請求失敗時]，noticeKafkaProducer发送消息，topic：tech-sj-pt-notice-topic，tag：sompo-za-graphene-notice-send&lt;br&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Lucida Console;fontSize=16;" parent="98" vertex="1"><mxGeometry x="1867" y="3198" width="390" height="152" as="geometry"/></mxCell><mxCell id="401" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;entryPerimeter=0;fontFamily=Lucida Console;fontSize=18;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="98" source="394" target="399" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="394" value="&lt;div class=&quot;mind-clipboard&quot;&gt;每月最后一天的16点（最后一次扣款依然失败）&lt;/div&gt;&lt;div class=&quot;mind-clipboard&quot;&gt;businessType=[POLICY_BATCH_CHANGE_POLICY_&lt;br&gt;CANCELLATIONOFNONPAYMENT_NOTICE(45, &quot;不払解除&quot;)]，template=[NOTIFICATION_POLICY_&lt;br&gt;CANCELLATION(&quot;0100&quot;, &quot;請求不能＆契約解除通知&quot;)]，noticeKafkaProducer发送消息，topic：tech-sj-pt-notice-topic，tag：sompo-za-graphene-notice-send&lt;br&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Lucida Console;fontSize=16;" parent="98" vertex="1"><mxGeometry x="2407" y="3188" width="410" height="172" as="geometry"/></mxCell><mxCell id="399" value="&lt;font color=&quot;#323232&quot;&gt;&lt;span style=&quot;background-color: rgba(255, 255, 255, 0.01);&quot;&gt;&lt;span style=&quot;font-size: 18px;&quot;&gt;stop&lt;/span&gt;&lt;br&gt;&lt;/span&gt;&lt;/font&gt;" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.start_2;whiteSpace=wrap;fillColor=#f8cecc;strokeColor=#b85450;fontFamily=Lucida Console;" parent="98" vertex="1"><mxGeometry x="2303.75" y="3478" width="87" height="81" as="geometry"/></mxCell><mxCell id="404" value="update bcp" style="swimlane;whiteSpace=wrap;html=1;fontFamily=Lucida Console;fontSize=18;" parent="98" vertex="1"><mxGeometry x="3188" y="2422" width="681" height="512" as="geometry"/></mxCell><mxCell id="405" value="&lt;div class=&quot;mind-clipboard&quot; style=&quot;font-size: 14px;&quot;&gt;UPDATE bill &lt;div style=&quot;font-size: 14px;&quot;&gt;&lt;/div&gt;SET arap_account_no = '9362908',&lt;div style=&quot;font-size: 14px;&quot;&gt;&lt;/div&gt;arap_account_type = 123,&lt;div style=&quot;font-size: 14px;&quot;&gt;&lt;/div&gt;third_party_transaction_no = '4309202208230141571977',&lt;div style=&quot;font-size: 14px;&quot;&gt;&lt;/div&gt;third_party_transaction_id = 20210322154214,&lt;div style=&quot;font-size: 14px;&quot;&gt;&lt;/div&gt;third_party_tracking_id = '309202208230141571977',&lt;div style=&quot;font-size: 14px;&quot;&gt;&lt;/div&gt;third_party_payment_no = '20210322154214',&lt;div style=&quot;font-size: 14px;&quot;&gt;&lt;/div&gt;gmt_modified = CURRENT_TIMESTAMP ( 3 ) &lt;div style=&quot;font-size: 14px;&quot;&gt;&lt;/div&gt;WHERE&lt;div style=&quot;font-size: 14px;&quot;&gt;&lt;/div&gt;id = 9560101 &lt;div style=&quot;font-size: 14px;&quot;&gt;&lt;/div&gt;AND payee_id = 9703721&lt;/div&gt;" style="shape=note;size=20;whiteSpace=wrap;html=1;fontFamily=Lucida Console;fontSize=14;align=left;" parent="404" vertex="1"><mxGeometry x="18" y="43" width="260" height="290" as="geometry"/></mxCell><mxCell id="406" value="&lt;div class=&quot;mind-clipboard&quot; style=&quot;font-size: 14px;&quot;&gt;&lt;span style=&quot;color: rgb(50, 50, 50); font-size: 14px; background-color: rgba(255, 255, 255, 0.01);&quot;&gt;insert into collection_transaction ( id, collection_balance_id, biz_apply_no, payee_trans_type, pay_method, fee_amount, fee_type, currency, pay_account_no, bank_branch_code... ) values ( 9742480, 9550463, 10213636, 100, 123, 357, 'C600', 4, 9364720, null, null, 1, '2022-11-11 15:00:00.0', 2, 9561542, null, '406655340915092|L9282200', 4, null, null, '2022-11-11 15:00:00.0', '2022-11-11 15:00:00.0', null... )&lt;/span&gt;&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/div&gt;" style="shape=note;size=20;whiteSpace=wrap;html=1;fontFamily=Lucida Console;fontSize=14;align=left;" parent="404" vertex="1"><mxGeometry x="298" y="80" width="362" height="213" as="geometry"/></mxCell><mxCell id="407" value="&lt;div class=&quot;mind-clipboard&quot; style=&quot;font-size: 14px;&quot;&gt;&lt;div class=&quot;mind-clipboard&quot;&gt;INSERT/UPDATE&lt;br&gt;&lt;/div&gt;&lt;div class=&quot;mind-clipboard&quot;&gt;collection_balance &lt;div&gt;&lt;/div&gt;SET balance = 360,&lt;div&gt;&lt;/div&gt;gmt_modified = CURRENT_TIMESTAMP ( 3 ) &lt;div&gt;&lt;/div&gt;WHERE&lt;div&gt;&lt;/div&gt;id = 9550463&lt;div&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="shape=note;size=20;whiteSpace=wrap;html=1;fontFamily=Lucida Console;fontSize=14;align=left;" parent="404" vertex="1"><mxGeometry x="18" y="364" width="240" height="130" as="geometry"/></mxCell><mxCell id="408" value="&lt;div class=&quot;mind-clipboard&quot; style=&quot;font-size: 14px;&quot;&gt;&lt;div class=&quot;mind-clipboard&quot;&gt;UPDATE bcp_ext_info &lt;div&gt;&lt;/div&gt;SET ext_value = '309202207140141058040',&lt;div&gt;&lt;/div&gt;fee_status = 8,&lt;div&gt;&lt;/div&gt;current_index = 2,&lt;div&gt;&lt;/div&gt;check_date = $bizTime,&lt;div&gt;&lt;/div&gt;gmt_modified = now() &lt;div&gt;&lt;/div&gt;WHERE&lt;div&gt;&lt;/div&gt;id = 9253052&lt;div&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="shape=note;size=20;whiteSpace=wrap;html=1;fontFamily=Lucida Console;fontSize=14;align=left;" parent="404" vertex="1"><mxGeometry x="298" y="324" width="217" height="170" as="geometry"/></mxCell><mxCell id="420" value="/bcp/queryBcpPage" style="rounded=1;whiteSpace=wrap;html=1;fontSize=16;fontFamily=Lucida Console;" parent="98" vertex="1"><mxGeometry x="1141.27" y="4128" width="180" height="72" as="geometry"/></mxCell><mxCell id="448" value="/bcp/modifyBcpInfo" style="rounded=1;whiteSpace=wrap;html=1;fontSize=16;fontFamily=Lucida Console;" parent="98" vertex="1"><mxGeometry x="1350" y="3688" width="180" height="72" as="geometry"/></mxCell><mxCell id="463" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Lucida Console;fontSize=16;dashed=1;" parent="98" source="461" target="462" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="465" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Lucida Console;fontSize=16;" parent="98" source="461" target="464" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="461" value="查询bill及相关detail" style="rounded=1;whiteSpace=wrap;html=1;fontSize=16;fontFamily=Lucida Console;" parent="98" vertex="1"><mxGeometry x="1770" y="3668" width="120" height="60" as="geometry"/></mxCell><mxCell id="462" value="bill&lt;br&gt;receivable_payable&lt;br&gt;bcp_ext_info" style="shape=note;size=20;whiteSpace=wrap;html=1;fontFamily=Lucida Console;fontSize=16;" parent="98" vertex="1"><mxGeometry x="2045" y="3647" width="200" height="102" as="geometry"/></mxCell><mxCell id="467" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;entryPerimeter=0;fontFamily=Lucida Console;fontSize=16;" parent="98" source="464" target="466" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="468" value="ELSE" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=16;fontFamily=Lucida Console;" parent="467" vertex="1" connectable="0"><mxGeometry x="-0.2053" y="-3" relative="1" as="geometry"><mxPoint x="1" y="3" as="offset"/></mxGeometry></mxCell><mxCell id="470" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontFamily=Lucida Console;fontSize=16;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="98" source="464" target="469" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="473" value="TRANSFER_FAILURE" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=16;fontFamily=Lucida Console;" parent="470" vertex="1" connectable="0"><mxGeometry x="-0.715" y="-1" relative="1" as="geometry"><mxPoint as="offset"/></mxGeometry></mxCell><mxCell id="471" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontFamily=Lucida Console;fontSize=16;" parent="98" source="464" target="469" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="472" value="PENDING" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=16;fontFamily=Lucida Console;" parent="471" vertex="1" connectable="0"><mxGeometry x="-0.0437" y="-2" relative="1" as="geometry"><mxPoint x="-38" y="-3" as="offset"/></mxGeometry></mxCell><mxCell id="464" value="billStatus" style="rhombus;whiteSpace=wrap;html=1;fontFamily=Lucida Console;fontSize=16;" parent="98" vertex="1"><mxGeometry x="1790" y="3798" width="80" height="80" as="geometry"/></mxCell><mxCell id="466" value="&lt;font color=&quot;#323232&quot;&gt;&lt;span style=&quot;background-color: rgba(255, 255, 255, 0.01);&quot;&gt;&lt;span style=&quot;font-size: 18px;&quot;&gt;stop&lt;/span&gt;&lt;br&gt;&lt;/span&gt;&lt;/font&gt;" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.start_2;whiteSpace=wrap;fillColor=#f8cecc;strokeColor=#b85450;fontFamily=Lucida Console;" parent="98" vertex="1"><mxGeometry x="1610" y="3928" width="87" height="81" as="geometry"/></mxCell><mxCell id="475" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Lucida Console;fontSize=16;" parent="98" source="469" target="474" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="469" value="查询续期余额&lt;br&gt;[collection_balance]" style="rounded=1;whiteSpace=wrap;html=1;fontSize=16;fontFamily=Lucida Console;" parent="98" vertex="1"><mxGeometry x="1950" y="3938.5" width="120" height="60" as="geometry"/></mxCell><mxCell id="477" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Lucida Console;fontSize=16;" parent="98" source="474" target="476" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="474" value="插入余额抵扣的实收数据[collection_transaction]" style="rounded=1;whiteSpace=wrap;html=1;fontSize=16;fontFamily=Lucida Console;" parent="98" vertex="1"><mxGeometry x="1945" y="4066" width="130" height="62" as="geometry"/></mxCell><mxCell id="479" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Lucida Console;fontSize=16;" parent="98" source="476" target="478" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="476" value="冲销续期余额，会变成0，更新&lt;br&gt;[collection_balance]" style="rounded=1;whiteSpace=wrap;html=1;fontSize=16;fontFamily=Lucida Console;" parent="98" vertex="1"><mxGeometry x="1937.5" y="4188" width="145" height="72" as="geometry"/></mxCell><mxCell id="481" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Lucida Console;fontSize=16;" parent="98" source="478" target="480" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="478" value="插入冲销记录数据[cp_note_offset]" style="rounded=1;whiteSpace=wrap;html=1;fontSize=16;fontFamily=Lucida Console;" parent="98" vertex="1"><mxGeometry x="1945" y="4326" width="130" height="62" as="geometry"/></mxCell><mxCell id="483" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Lucida Console;fontSize=16;" parent="98" source="480" target="482" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="480" value="&lt;div&gt;setBillStatus(BillStatusEnum.CONFIRMED);&lt;/div&gt;&lt;div&gt;setBillConfirmDate($bizDate);&lt;/div&gt;更新bill" style="rounded=1;whiteSpace=wrap;html=1;fontSize=16;fontFamily=Lucida Console;" parent="98" vertex="1"><mxGeometry x="1917.5" y="4452" width="185" height="72" as="geometry"/></mxCell><mxCell id="488" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="98" source="482" target="487" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="482" value="插入发票数据[invoice、invoice_detail]" style="rounded=1;whiteSpace=wrap;html=1;fontSize=16;fontFamily=Lucida Console;" parent="98" vertex="1"><mxGeometry x="1932.5" y="4585" width="155" height="82" as="geometry"/></mxCell><mxCell id="486" value="&lt;font color=&quot;#323232&quot;&gt;&lt;span style=&quot;background-color: rgba(255, 255, 255, 0.01);&quot;&gt;&lt;span style=&quot;font-size: 18px;&quot;&gt;stop&lt;/span&gt;&lt;br&gt;&lt;/span&gt;&lt;/font&gt;" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.start_2;whiteSpace=wrap;fillColor=#f8cecc;strokeColor=#b85450;fontFamily=Lucida Console;" parent="98" vertex="1"><mxGeometry x="1966.5" y="4918" width="87" height="81" as="geometry"/></mxCell><mxCell id="489" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="98" source="487" target="486" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="487" value="发送bcp消息，topic:tech-sj-环境-bcp-topic，tag:za-graphene-bcp-notice-account-check，&lt;br&gt;主要是作用是佣金..." style="rounded=1;whiteSpace=wrap;html=1;fontSize=16;fontFamily=Lucida Console;" parent="98" vertex="1"><mxGeometry x="1891.25" y="4738" width="237.5" height="112" as="geometry"/></mxCell><mxCell id="301" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontFamily=Lucida Console;fontSize=16;" parent="1" source="300" target="299" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="300" value="&lt;span style=&quot;color: rgb(50, 50, 50); background-color: rgba(255, 255, 255, 0.01);&quot;&gt;&lt;font&gt;RenewAuthoryByPayPalStrategy&lt;br&gt;operate&lt;/font&gt;&lt;/span&gt;" style="rounded=1;html=1;fontFamily=Lucida Console;fontSize=16;whiteSpace=wrap;" parent="1" vertex="1"><mxGeometry x="2412" y="1743" width="160" height="48" as="geometry"/></mxCell><mxCell id="352" value="outbound" style="swimlane;horizontal=0;whiteSpace=wrap;html=1;fontSize=16;" parent="1" vertex="1"><mxGeometry x="20" y="449" width="3960" height="270" as="geometry"/></mxCell><mxCell id="353" value="/outbound/apply" style="rounded=1;whiteSpace=wrap;html=1;dashed=1;fontSize=16;fontFamily=Lucida Console;" parent="352" vertex="1"><mxGeometry x="3600" y="105" width="150" height="55" as="geometry"/></mxCell><mxCell id="357" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=1;entryDx=0;entryDy=0;dashed=1;fontFamily=Lucida Console;fontSize=16;" parent="1" source="339" target="353" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="373" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Lucida Console;fontSize=18;dashed=1;" parent="1" source="362" edge="1"><mxGeometry relative="1" as="geometry"><mxPoint x="3695" y="280" as="targetPoint"/></mxGeometry></mxCell><mxCell id="411" value="policyBatch" style="swimlane;horizontal=0;whiteSpace=wrap;html=1;fontSize=16;fontFamily=Lucida Console;" parent="1" vertex="1"><mxGeometry x="20" y="5955" width="3960" height="2390" as="geometry"/></mxCell><mxCell id="410" value="/policybatch&lt;br&gt;/confirmRenewBill" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Lucida Console;fontSize=16;" parent="411" vertex="1"><mxGeometry x="686" y="80" width="174" height="60" as="geometry"/></mxCell><mxCell id="414" value="&lt;div&gt;SELECT&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;&quot;&gt;&#9;&lt;/span&gt;*&amp;nbsp;&lt;/div&gt;&lt;div&gt;FROM&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;&quot;&gt;&#9;&lt;/span&gt;`sj_gr_policy_batch`.&lt;br&gt;`renew_policy_transaction`&amp;nbsp;&lt;/div&gt;&lt;div&gt;WHERE&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;&quot;&gt;&#9;&lt;/span&gt;`policy_no` = 'SAD303438562'&amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;&quot;&gt;&#9;&lt;/span&gt;AND `renew_transaction_no` = '309202212140154851863'&amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;&quot;&gt;&#9;&lt;/span&gt;AND `status` = '1'&amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;&quot;&gt;&#9;&lt;/span&gt;LIMIT 0,1000&lt;/div&gt;" style="shape=note;size=20;whiteSpace=wrap;html=1;fontSize=16;align=left;fontFamily=Lucida Console;" parent="411" vertex="1"><mxGeometry x="330" y="180" width="290" height="220" as="geometry"/></mxCell><mxCell id="417" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;" parent="411" source="415" target="414" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="419" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="411" source="415" target="418" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="415" value="根据入参中的保单号、续期业务号、以及状态=[INIT(1, &quot;初始化状态&quot;)]，查询续期交易表[renew_policy_transaction]、续期交易明细表[renew_policy_transaction_detail]" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Lucida Console;fontSize=16;" parent="411" vertex="1"><mxGeometry x="720" y="240" width="360" height="100" as="geometry"/></mxCell><mxCell id="423" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Lucida Console;fontSize=16;" parent="411" source="418" target="421" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="418" value="&lt;font face=&quot;Lucida Console&quot;&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;根据续期交易记录上的字段[renew_policy_premium_schedule_id&lt;/span&gt;&lt;/font&gt;&lt;font face=&quot;Lucida Console&quot;&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;]&lt;br&gt;&lt;/span&gt;&lt;/font&gt;&lt;span style=&quot;font-family: &amp;quot;Lucida Console&amp;quot;; font-size: 16px;&quot;&gt;查询续期相关信息(包括续期计划，缴费人信息，缴费频率，险种保费信息，险种计划,交易信息)[renew_policy_premium_schedule]表记录&lt;/span&gt;&lt;font face=&quot;Lucida Console&quot;&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="411" vertex="1"><mxGeometry x="722.5" y="410" width="355" height="110" as="geometry"/></mxCell><mxCell id="425" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Lucida Console;fontSize=16;" parent="411" source="421" target="424" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="421" value="&lt;font face=&quot;Lucida Console&quot;&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;根据保单号、续期业务号查询bcp的bill&lt;/span&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="411" vertex="1"><mxGeometry x="807.5" y="609" width="185" height="64" as="geometry"/></mxCell><mxCell id="441" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Lucida Console;fontSize=16;" parent="411" source="424" target="440" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="424" value="&lt;font face=&quot;Lucida Console&quot;&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;查询保单信息&lt;/span&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="411" vertex="1"><mxGeometry x="833.75" y="755" width="132.5" height="43" as="geometry"/></mxCell><mxCell id="443" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Lucida Console;fontSize=16;" parent="411" source="440" target="442" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="444" value="ELSE" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=16;fontFamily=Lucida Console;" parent="443" vertex="1" connectable="0"><mxGeometry x="-0.2065" y="-3" relative="1" as="geometry"><mxPoint as="offset"/></mxGeometry></mxCell><mxCell id="446" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Lucida Console;fontSize=16;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="411" source="440" target="449" edge="1"><mxGeometry relative="1" as="geometry"><mxPoint x="900" y="1115" as="targetPoint"/></mxGeometry></mxCell><mxCell id="447" value="生效" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=16;fontFamily=Lucida Console;" parent="446" vertex="1" connectable="0"><mxGeometry x="-0.2444" y="1" relative="1" as="geometry"><mxPoint as="offset"/></mxGeometry></mxCell><mxCell id="440" value="保单状态" style="rhombus;whiteSpace=wrap;html=1;fontFamily=Lucida Console;fontSize=16;" parent="411" vertex="1"><mxGeometry x="860" y="885" width="80" height="80" as="geometry"/></mxCell><mxCell id="442" value="&lt;font color=&quot;#323232&quot;&gt;&lt;span style=&quot;background-color: rgba(255, 255, 255, 0.01);&quot;&gt;&lt;span style=&quot;font-size: 18px;&quot;&gt;stop&lt;/span&gt;&lt;br&gt;&lt;/span&gt;&lt;/font&gt;" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.start_2;whiteSpace=wrap;fillColor=#f8cecc;strokeColor=#b85450;fontFamily=Lucida Console;" parent="411" vertex="1"><mxGeometry x="650" y="884" width="87" height="81" as="geometry"/></mxCell><mxCell id="453" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Lucida Console;fontSize=16;" parent="411" source="449" target="452" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="449" value="confirmRenewBill" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Lucida Console;fontSize=16;" parent="411" vertex="1"><mxGeometry x="820" y="1063" width="160" height="40" as="geometry"/></mxCell><mxCell id="456" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Lucida Console;fontSize=16;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="411" source="452" target="455" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="452" value="续期计划上的字段[&lt;span style=&quot;text-align: left;&quot;&gt;due_date&lt;/span&gt;、&lt;span style=&quot;text-align: left;&quot;&gt;unpaid_cancel_date&lt;/span&gt;]对应的月份+1，得到变量[dueDate、unPaidCancelDate]" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Lucida Console;fontSize=16;" parent="411" vertex="1"><mxGeometry x="741.25" y="1177" width="317.5" height="90" as="geometry"/></mxCell><mxCell id="460" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Lucida Console;fontSize=16;" parent="411" source="455" target="459" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="455" value="更新保单对应的[policy_product_renew 保单缴费续期]中的[due_date]，如果是最后一期保费，同时更新[premium_status]=[FINISH_PAYMENT(4, &quot;保费缴清&quot;)]，[premium_status_change_cause]=[PREMIUM_PAY_OFF(2, &quot;保费缴清&quot;)]" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Lucida Console;fontSize=16;" parent="411" vertex="1"><mxGeometry x="730" y="1349" width="340" height="130" as="geometry"/></mxCell><mxCell id="459" value="&lt;ol&gt;&lt;li&gt;更新续期计划[renew_policy_premium_schedule]，&lt;br&gt;如果是最后一期，更新字段[prem_status]=[FINISH_PAYMENT(4, &quot;保费缴清&quot;)]，[prem_status_change_cause]=[PREMIUM_PAY_OFF(2, &quot;保费缴清&quot;)]，&lt;br&gt;如果非最后一期，更新字段[due_date]=[dueDate]，[unpaid_cancel_date]=[&lt;span style=&quot;text-align: center;&quot;&gt;unPaidCancelDate&lt;/span&gt;]&lt;/li&gt;&lt;li&gt;更新续期交易[renew_policy_transaction]，更新字段[status]=[CONFIRMED(2, &quot;确认状态&quot;)]，[due_date]=[dueDate]&lt;/li&gt;&lt;li&gt;更新续期交易明细[renew_policy_transaction_detail]，更新字段[status]=[CONFIRMED(2, &quot;确认状态&quot;)]，[due_date]=[dueDate]&lt;/li&gt;&lt;/ol&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Lucida Console;fontSize=16;align=left;" parent="411" vertex="1"><mxGeometry x="645.9399999999999" y="1570" width="508.12" height="266" as="geometry"/></mxCell><mxCell id="413" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=16;dashed=1;" parent="1" source="281" target="410" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="422" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=1;entryDx=0;entryDy=0;dashed=1;fontFamily=Lucida Console;fontSize=16;" parent="1" source="421" target="420" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="426" value="policy" style="swimlane;horizontal=0;whiteSpace=wrap;html=1;fontSize=16;fontFamily=Lucida Console;" parent="1" vertex="1"><mxGeometry x="20" y="8375" width="3930" height="425" as="geometry"/></mxCell><mxCell id="438" value="/policy&lt;br&gt;/queryPolicyByCondition" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Lucida Console;fontSize=16;" parent="426" vertex="1"><mxGeometry x="1061" y="120" width="241" height="70" as="geometry"/></mxCell><mxCell id="457" value="/policy&lt;br&gt;/commitChangePolicy" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Lucida Console;fontSize=16;" parent="426" vertex="1"><mxGeometry x="1370" y="250" width="241" height="70" as="geometry"/></mxCell><mxCell id="439" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontFamily=Lucida Console;fontSize=16;dashed=1;" parent="1" source="424" target="438" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="451" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=1;entryDx=0;entryDy=0;fontFamily=Lucida Console;fontSize=16;dashed=1;" parent="1" source="449" target="448" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="458" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Lucida Console;fontSize=16;dashed=1;" parent="1" source="455" target="457" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell></root></mxGraphModel></diagram></mxfile>